angular.module("UI-Loader",[]).controller("Geolocate",["$scope","$window","$http","$sce","getLocation","$rootScope","$q","$routeParams",function(o,t,e,n,r,a,s){($("#map").html().match('loading.gif"')||window.location.hash.split("/")<2||void 0!=localStorage.country)&&(s.noSongs=!1,r.checkGeoLocation())}]),angular.module("Forms",[]).controller("formController",["$scope","$rootScope","retrieveLocation","getLocation","$q","HashCreate","$location","HintShower","$timeout","States","$routeParams",function(o,t,e,n,r,a,s,i,l,c){t.showHint=!1;var g=0;count2=0,o.hintShower=function(e){g+=1,l(function(){count2+=1,count2==g&&i.showHint(o.type_location).then(function(e){if(void 0!=e){t.showHint=!0,o.hints=e.finalArr,o.finalHints=[];for(var n="",r="",a=0;a<o.hints.length;a++)r.replace(/\W/g,"").match(o.hints[a].state.replace(/\W/g,""))||o.finalHints.push(o.hints[a]),n+=o.hints[a].city,r+=o.hints[a].state}})},300),o.location_=e,toTitleCase(o.location_).match("St.")&&(o.location_=o.location_.replace("St.","Saint")),toTitleCase(o.location_).match("New York,")&&(o.location_=o.location_.replace("New York,","New York City,")),o.type_location=o.location_.split(", ")},o.controlForm=function(t){var e=c.createStateObj();if(o.location=t,o.genres="",null==o.location||""==o.location){{r.defer()}n.checkGeoLocation()}else{if(2==o.location.length)for(var a=t.toUpperCase(),i=0;i<e.length;i++)e[i].abbreviation==a&&(o.location=e[i].name);s.path("playlist/"+o.location.replace(", ","*"))}},o.closeHint=function(){t.showHint=!1,o.location=""}}]).controller("hashedLocation",["$scope","$rootScope","retrieveLocation","LocationDataFetch","$location","$routeParams","$q","runSymbolChange","PlaylistCreate","Wiki","MapCreate","States","$sce","Favorites","ShareSongs","getLocation","Spotify","HashCreate","ChunkSongs","loadPlaylist",function(o,t,e,n,r,a,s,i,l,c,g,u,d,h,_,p,f,m,v){t.noGeo=!1;if(t.loading=!0,o.sharer=!1,o.shareBox=!1,t.tags=[],o.aboutShower=!1,o.fromShower=!0,songs_for_service=[],1==o.tooMany,t.marked=!1,t.aboutMarked=!1,o.btnCount=0,o.collector_arr=[],o.finalcollector=[],o.finalcollector.idStr="",o.finalcollector.idArr=[],o.finalcollector.savSpotArr=[],o.finalcollector.location_arr=[],o.finalcollector.artistlocation="",o.finalcollector.artistlocations={latitude:[],longitude:[]},o.number=0,o.countRunUserSearch=0,o.nearBy=0,o.citySearch=0,o.lengthy=0,o.showCityMessage=!1,t.moreLookUp=!1,t.prevLookUp=!1,o.counter=0,o.runApp=function(s,i,c,g,u,p,m){if(void 0==g)var g=[];else var g=g;if(o.holder_arr=void 0==u?[]:u,o.index1=void 0==p?0:p,o.index2=void 0==m?20:m,o.songs=[],o.songs.spot_arr=[],o.spot_arr=[],o.savSpotArr=[],o.location_arr=[],o.final_loc_arr=[],o.shareBox=!1,t.trackStorage=localStorage.country,o.start_number=s,o.ratio=.15*i,o.counter=i,0==n.count||void 0==t.songs_root||1==t.noSongs)t.mapOpening=!0,o.lookUpSongs=[],t.holder=[],t.loading=!0,o.lookupSongs=[],t.aboutMarked=!1,e.runLocation(replacePatterns(S),"lat",i).then(function(s){o.latitudeObj=s,t.latitudeObj_root=s,o.latitude=o.latitudeObj.latitude,e.runLocation(replacePatterns(o.location),"long",i).then(function(e){void 0==e.longitude&&(n.count=0),t.longitudeObj_root={},o.longitudeObj=e,t.longitudeObj_root=e,o.longitude=o.longitudeObj.longitude,o.geolocation=[o.latitudeObj,o.longitudeObj];var s=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),i=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_min),c=(o.latitudeObj.lat_max+o.latitudeObj.lat_min)/2,u=(o.longitudeObj.long_max+o.longitudeObj.long_min)/2;if(s>i)var p=s;else var p=i;if(o.zoom=a.location.split("*").length>1?f.runRange(p):6,void 0==a.qs){var m=[];o.sharer=!1,o.shareBox=!1;for(var b=0;5>b;b++)o.start_number=50*b,l.runPlaylist(o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.latitudeObj.lat_min,o.latitudeObj.lat_max,o.longitudeObj.long_min,o.longitudeObj.long_max,t.genres,t.era,o.start_number).then(function(e){if(g=g.concat(e),m.push(b),m.length==b)if(0==e.songsArr.length&&o.holder_arr.length>0){t.loading=!1,o.btnCount>0?(o.noMoreSongs=!0,o.moreHider=!0):(o.noMoreSongs=!1,o.moreHider=!1),o.donesy=!0;{o.holder_arr.length-20,o.holder_arr.length}f.createPlaylist(o.holder_arr).then(function(e){o.songs=e.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=e.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=e.savSpotArr.slice(o.index1,o.index2+20),artistlocation=e.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=e.location_arr.slice(o.index1,o.index2+20),o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),t.songs_root=o.songs,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr),o.stillLooking=!1,t.loading=!1},function(){o.errorMessage=!0})}else g.length<100&&o.counter<=5?(o.counter=o.counter+1,1==t.marked?(o.moreHider=!0,o.loading=!1,o.noMoreSongs=!0):o.counter<=5&&o.holder_arr.length<50?(o.counter>3&&(o.stillLooking=!0),o.start_number=o.start_number+50,n.count=0,o.runApp(o.start_number,o.counter,"",g,o.holder_arr)):0==g.length?t.noSongs=!0:g.length<=50&&(o.counter>=6||0==e.songsArr.length)?f.checkSongMarket(g).then(function(e){for(var n=[],r=0;r<e.length;r++)n.push(r),songs_for_service.push(e[r]),n.length==e.length&&(o.holder_songs={},o.holder_arr=songs_for_service,t.holder_arr_root=songs_for_service,o.holder_arr.length<=20&&(o.moreHider=!0),f.createPlaylist(songs_for_service).then(function(e){o.holder_songs.songs=e.songs,o.songs=e.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=e.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=e.savSpotArr.slice(o.index1,o.index2+20),artistlocation=e.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=e.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),t.songs_root=o.songs,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr),king=!1,t.loading=!1,t.mapOpening=!1,o.checkForMore=!1},function(){o.errorMessage=!0}))}):g.length>50&&g.length<100&&o.counter>=6&&v.createChunks(g,50).then(function(e){for(var n=[],r=[],a=0;a<e.length;a++)n.push(a),f.checkSongMarket(e[a].songs).then(function(a){for(var s=0;s<a.length;s++)r.push(s),songs_for_service.push(a[s]),n.length==e.length&&r.length==a.length&&(o.holder_songs={},o.holder_arr=songs_for_service,t.holder_arr_root=songs_for_service,f.createPlaylist(songs_for_service).then(function(e){o.holder_songs.songs=e.songs,o.songs=e.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=e.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=e.savSpotArr.slice(o.index1,o.index2+20),artistlocation=e.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=e.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),t.songs_root=o.songs,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr),o.stillLooking=!1,t.loading=!1,t.mapOpening=!1,o.checkForMore=!0,t.loading=!1},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0})):g.length>50&&(0==o.donesy||void 0==o.donesy)?v.createChunks(g,50).then(function(e){for(var r=[],a=[],s=0;s<e.length;s++)r.push(s),f.checkSongMarket(e[s].songs).then(function(s){for(var i=0;i<s.length;i++)a.push(i),songs_for_service.push(s[i]),r.length==e.length&&a.length==s.length&&(o.holder_songs={},o.holder_arr=songs_for_service,t.holder_arr_root=songs_for_service,s.length%20>0&&o.counter<2&&o.holder_arr.length<150?(o.counter++,n.count=0,o.runApp(o.start_number,o.counter,"",[],o.holder_arr)):f.createPlaylist(songs_for_service).then(function(e){o.holder_songs.songs=e.songs,o.songs=e.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=e.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=e.savSpotArr.slice(o.index1,o.index2+20),artistlocation=e.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=e.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),t.songs_root=o.songs,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr),o.stillLooking=!1,t.loading=!1,t.mapOpening=!1,o.checkForMore=!0,t.loading=!1},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0}):0==g.length&&(t.noSongs=!0,r.path("#/map"))},function(){o.errorMessage=!0})}else _.createSongsList().then(function(e){o.sharer=!0,o.shareBox=!1,o.songs=e,o.songs.pop(),o.spot_arr=o.songs.spot_arr,o.savSpotArr=o.songs.savSpotArr,t.loading=!1,o.zoom=a.location.split("*").length>1?10:6,o.counter=0;for(var r=0;r<o.songs.length;r++)o.songs[r].num_id=r,o.songs[r].favorite="off",h.checkFavorites(o.songs[r]);t.songs_root=o.songs,o.moreHider=!0,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,c,u,o.songs.spot_arr),t.idStr="",t.idArr=[],t.savIdArr=[],t.titleArr=[],n.count=0},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},function(){o.errorMessage=!0});else if(void 0!=t.longitudeObj_root.location&&S.replace("*",", ").replace(/_/g," ").toLowerCase()!=t.longitudeObj_root.location.replace(/_/g," ").toLowerCase()&&0!=b)n.count=0,t.latitudeObj_root.location=a.location.replace("*"," "),t.era="",t.start_year="",t.end_year="",o.runApp(0,1,"",[],[]);else if(n.count>0){o.shareBox=!1,o.latitudeObj={},o.longitudeObj={},o.songs={},o.latitudeObj=t.latitudeObj_root,o.longitudeObj=t.longitudeObj_root,o.songs=t.songs_root,forEach(o.songs,function(o){h.checkFavorites(o)}),o.holder_arr=t.holder_arr_root,null!=t.finalcollector_arr?(o.finalcollector=t.finalcollector_arr,o.lookUpSongs=t.lookUpSongs_arr,o.lookUpSongs.idStr=t.lookUpSongs_arr.idStr):(o.finalcollector=[],o.lookUpSongs=[],o.lookUpSongs.idStr=""),o.finalcollector.length>15&&(o.moreLookUp=!0);var y=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),x=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_max);if(y>x)var k=y;else var k=x;if(o.zoom=f.runRange(k),o.stillLooking=!1,t.loading=!1,t.aboutMarked=!0,n.count>=1e11){o.createMapArtist(o.songs.location_arr,0,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.spot_arr),t.idStr="",t.idArr=[],t.savIdArr=[],t.titleArr=[];for(var O=0;O<o.songs.length;O++)o.songs[O].favorite="off",h.checkFavorites(o.songs[O])}}b=n.count+=1},o.icons=t.icons,i.changeSymbol(),o.song_str="",t.showHint=!1,o.createMapArtist=function(e,n,r,a,s,i,l){f.createLatLng(e,n,r,a,s,i,l).then(function(o){t.mapdata=o}),o.stillLooking=!1,t.loading=!1},o.runSongAboutSearch=function(t){o.loading_tags=!0,o.number=t;o.start_index=t,o.iterator=20;var e=a.location;if(e=e.replace(/_/g," "),"WASHINGTON*DISTRICT_OF_COLUMBIA"==e&&(e="Washington, DC"),e.split("*").length>1){for(var r=u.createStateObj(),s=0;s<r.length;s++)if(e.toLowerCase().split("*")[1]==r[s].name.toLowerCase())var i=e.split("*")[0]+", "+r[s].name,l=e.split("*")[0]+", "+r[s].abbreviation;else if(e.toLowerCase().split("*")[1]==r[s].abbreviation.toLowerCase())var i=e.split("*")[0]+", "+r[s].name,l=e.split("*")[0]+", "+r[s].abbreviation;else if(s==r.length-1&&void 0==i)var l=e;o.runUserSearch(l,30,"no","auto")}else o.runUserSearch(e,30,"no","auto");n.count=1e11},o.runUserSearch=function(e,r,a,s){if(0==t.aboutMarked||n.count<1e11||o.finalcollector.length<50&&0==o.lookUpSongs.length){o.finalcollector.idArr=[],o.finalcollector.savSpotArr=[],o.finalcollector.location_arr=[],o.location_arr=[],o.finalcollector.artistlocation="",o.finalcollector.artistlocations={latitude:[],longitude:[]};var i=0;f.runFusionTableJSON(t.latitudeObj_root.latitude,t.longitudeObj_root.longitude,.3).then(function(n){o.countRunUserSearch<4&&("auto"==s?(i=n.length,n.length>0&&n.length<400?(o.collector_arr=o.collector_arr.concat(n),f.runSpotifySearch(e,r,a).then(function(n){n.length;o.collector_arr=o.collector_arr.concat(n),o.runNearbySearch(t.latitudeObj_root.latitude,t.longitudeObj_root.longitude,e),o.countRunUserSearch++})):n.length>400?(o.collector_arr=o.collector_arr.concat(n),o.countRunUserSearch=2,o.parseSongData(o.collector_arr.reverse(),"yes")):0==n.length&&(o.runNearbySearch(t.latitudeObj_root.latitude,t.longitudeObj_root.longitude,e),o.countRunUserSearch++)):"user"==s?(o.collector_arr=[],f.runSpotifySearch(e,r,a).then(function(t){o.countRunUserSearch=2,o.parseSongData(t,"yes")})):f.runSpotifySearch(e,r,a).then("number"==typeof s?function(t){o.collector_arr=o.collector_arr.concat(t),o.countRunUserSearch=2,o.pass_length-1==s&&o.parseSongData(o.collector_arr,"no")}:function(t){o.collector_arr=o.collector_arr.concat(t),o.parseSongData(o.collector_arr,"no")}))},function(){o.errorMessage=!0})}else{{var l=Math.abs(o.finalcollector.artistlocations.latitude[o.finalcollector.artistlocations.latitude.length-2]-o.finalcollector.artistlocations.latitude[0]),c=Math.abs(o.finalcollector.artistlocations.longitude[o.finalcollector.artistlocations.longitude.length-2]-o.finalcollector.artistlocations.longitude[0]);(o.finalcollector.artistlocations.latitude[o.finalcollector.artistlocations.latitude.length-2]+o.finalcollector.artistlocations.latitude[0])/2,(o.finalcollector.artistlocations.longitude[o.finalcollector.artistlocations.longitude.length-2]+o.finalcollector.artistlocations.longitude[0])/2}if(l>c)var g=l;else var g=c;t.aboutMarked=!0,o.zoom=f.runRange(g),console.log(o.finalcollector),o.loading_tags=!1,o.parseSongData(o.finalcollector,"no")}},o.parseSongData=function(t,e){var n=[],r="";o.lengthy=o.lengthy+t.length;s.defer();if("yes"==e)var a=preventDuplicates(o.finalcollector,t,"id","push");else var a=t;for(var i=a.length,l=0;l<a.length;l++)a[l].favorite="off",""==localStorage.country&&void 0==localStorage.country||!a[l].available_markets.toString().match(localStorage.country)||f.lookUpEchonest(a[l]).then(function(t){n.push(a[l]),t.num_id=l,"yes"==e?(o.finalcollector.splice(0,0,t),o.finalcollector.idArr.splice(0,0,t.id),o.finalcollector.savSpotArr.splice(0,0,"spotify:track:"+t.id),o.location_arr.splice(0,0,t.artist_location.location+"@@"+t.artist_location.latitude+":"+t.artist_location.longitude+"&&<h5>"+t.name+"</h5><p>"+t.artists[0].name+'</p><a href="spotify:track:'+t.id+'" ><div class="spot_link"  aria-hidden="true" data-icon="c" id="infobox_spot_link"+x></div></a><a><a a href="#/info/'+t.artist_location.location.replace(", ","*").split(",")[0]+"/"+t.artists[0].name.replace("The ","")+'" ><div style="font-size:20px" class="spot_link information" id="infobox_info"+x  aria-hidden="true" data-icon="*"></div></a><div style="clear:both"></div>')):(o.finalcollector.push(t),o.finalcollector.idArr.push(t.id),o.finalcollector.savSpotArr.push("spotify:track:"+t.id),o.location_arr.push(t.artist_location.location+"@@"+t.artist_location.latitude+":"+t.artist_location.longitude+"&&<h5>"+t.name+"</h5><p>"+t.artists[0].name+'</p><a href="spotify:track:'+t.id+'" ><div class="spot_link"  aria-hidden="true" data-icon="c" id="infobox_spot_link"+x></div></a><a><a a href="#/info/'+t.artist_location.location.replace(", ","*").split(",")[0]+"/"+t.artists[0].name.replace("The ","")+'" ><div style="font-size:20px" class="spot_link information" id="infobox_info"+x  aria-hidden="true" data-icon="*"></div></a><div style="clear:both"></div>')),h.checkFavorites(t),o.finalcollector.artistlocation=t.artist_location.location,0==isNaN(t.artist_location.latitude)&&0==isNaN(t.artist_location.longitude)&&(o.finalcollector.artistlocations.latitude.push(parseFloat(t.artist_location.latitude)),o.finalcollector.artistlocations.longitude.push(parseFloat(t.artist_location.longitude)),o.finalcollector.artistlocations.latitude.sort(),o.finalcollector.artistlocations.longitude.sort()),i==n.length&&o.createMapAbout(o.finalcollector,0)}),r+=a[l].name,o.loading_tags=!1,o.aboutShower=!0},o.createMapAbout=function(e,r){console.log(e),o.finalcollector=e,0==o.finalcollector.length?o.showCityMessage=!0:o.finalcollector.length>15?(o.lookUpSongs=o.finalcollector.slice(r,r+o.iterator),o.lookUpSongs.savSpotArr=o.finalcollector.savSpotArr.slice(r,r+o.iterator),o.idArr=o.finalcollector.idArr.slice(o.start_index,o.iterator),o.finalcollector.location_arr=o.location_arr,t.idArr_arr=o.idArr.slice(0,o.iterator),t.lookUpSongs_arr=o.finalcollector.slice(r,r+o.iterator),t.finalcollector_arr=o.finalcollector,t.moreLookUp=!0,o.prevLookUp=!1):(o.lookUpSongs=o.finalcollector,t.lookUpSongs_arr=o.lookUpSongs,o.lookUpSongs.savSpotArr=o.finalcollector.savSpotArr,t.finalcollector_arr=o.finalcollector,o.idArr=o.finalcollector.idArr,t.idArr_arr=o.finalcollector.idArr,o.finalcollector.location_arr=o.location_arr,o.finalcollector.idStr=o.finalcollector.idArr.toString(),t.moreLookUp=!1);for(var a=0;a<o.lookUpSongs.length;a++)o.lookUpSongs[a].num_id=a;o.lookUpSongs.idStr=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.idArr.toString()),t.lookUpSongs_arr.idStr=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+t.idArr_arr.toString()),o.finalcollector.artistlocations.longitude.sort(),o.finalcollector.artistlocations.latitude.sort();var s=Math.abs(o.finalcollector.artistlocations.latitude[o.finalcollector.artistlocations.latitude.length-1]-o.finalcollector.artistlocations.latitude[0]),i=Math.abs(o.finalcollector.artistlocations.longitude[o.finalcollector.artistlocations.longitude.length-2]-o.finalcollector.artistlocations.longitude[0]),l=(o.finalcollector.artistlocations.latitude[o.finalcollector.artistlocations.latitude.length-1]+o.finalcollector.artistlocations.latitude[0])/2,c=(o.finalcollector.artistlocations.longitude[o.finalcollector.artistlocations.longitude.length-1]+o.finalcollector.artistlocations.longitude[0])/2;if(s>i)var g=s;else var g=i;o.zoom=f.runRange(g),f.createLatLng(o.finalcollector.location_arr,0,o.zoom,l,c,o.lookUpSongs).then(function(e){t.mapdata=e,n.count=2e11,t.loading_tags=!1,o.showCityMessage=!1,o.loading_tags=!1})},o.runNearbySearch=function(t,e,n){var r=(s.defer(),.3*o.nearBy);o.nearBy<=5&&f.createCities(t,e,r).then(function(r){var a=[];if(r.length>0){if(r.length<=2)var s=r.length;else var s=3;for(var i=0;s>i;i++)m.runHash(parseFloat(r[i].lat),parseFloat(r[i]["long"]),!1,.02).then(function(t){if(a.push(t),a.length==s){o.pass_length=a.length;for(var e=0;e<a.length;e++)o.runUserSearch(a[e].city,20,"yes",e)}})}else 0==r.length&&o.nearBy<=5&&(o.nearBy++,o.runNearbySearch(t,e,n));6==o.nearBy&&(o.countRunUserSearch++,o.runCitySearch(n))})},o.runCitySearch=function(t){o.countRunUserSearch++,o.runUserSearch(t.split(",")[0],15,"yes","")},o.runCityStateSearch=function(t){o.countRunUserSearch++,o.runUserSearch(t,30,"no","auto")},o.removeSong=function(t,e){if(o.spot_arr=[],"from"==e)for(var n=0;n<o.songs.length;n++){if(t==o.songs[n].id){o.songs[n].closeButton=!0,o.leaveOut.push(o.songs[n].id);var r=JSON.parse(localStorage.getItem("leaveOutArr"));null==r&&(r=[]);var a={title:o.songs[n].name,id:o.songs[n].id};localStorage.setItem("leaveOut",JSON.stringify(a)),r.push(a),localStorage.setItem("leaveOutArr",JSON.stringify(r))}else o.leaveOut.toString().replace(/\W/g,"").match(o.songs[n].id.replace(/\W/g,""))||o.spot_arr.push(o.songs[n].id);o.runApp(0,1,"",[],o.holder_arr)}else{o.lookUpSongs.idArr=[];for(var n=0;n<o.lookUpSongs.length;n++)if(t==o.lookUpSongs[n].id){o.lookUpSongs[n].closeButton=!0,o.leaveOut.push(o.lookUpSongs[n].id);var r=JSON.parse(localStorage.getItem("leaveOutArr"));null==r&&(r=[]);var a={song:o.lookUpSongs[n].name,id:o.lookUpSongs[n].id};localStorage.setItem("leaveOut",JSON.stringify(a)),r.push(a),localStorage.setItem("leaveOutArr",JSON.stringify(r))}else o.lookUpSongs.idArr.push(o.lookUpSongs[n].id)}o.lookUpSongs.idStr="https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.lookUpSongs.idArr.toString(),o.lookUpSongs.idStr=d.trustAsResourceUrl(o.lookUpSongs.idStr)},o.switchFavorite=function(t,e,n){var r=[];if(null!=localStorage.getItem("FavoriteArr")&&""!=localStorage.getItem("FavoriteArr"))var a=jQuery.parseJSON(localStorage.FavoriteArr);else var a=[];if("from"==n)if("off"==o.songs[e].favorite)o.songs[e].favorite="on",a.push(o.songs[e]),localStorage.setItem("FavoriteArr",JSON.stringify(a)),o.favorites=h.addFavorites();else{for(var s=0;s<a.length;s++)r.push(a[s].id);var i=r.indexOf(o.songs[e].id);a.splice(i,1),localStorage.setItem("FavoriteArr",JSON.stringify(a)),o.songs[e].favorite="off"}else if("about"==n)if("off"==o.lookUpSongs[e].favorite)(t=o.lookUpSongs[e].id)&&(o.lookUpSongs[e].favorite="on"),a.push(o.lookUpSongs[e]),localStorage.setItem("FavoriteArr",JSON.stringify(a)),o.favorites=h.addFavorites();else{console.log(a);for(var s=0;s<a.length;s++)r.push(a[s].id);var i=r.indexOf(o.songs[e].id);a.splice(i,1),localStorage.setItem("FavoriteArr",JSON.stringify(a)),o.lookUpSongs[e].favorite="off"}},o.goBack=function(){void 0!=o.location?(r.path("map/"+o.location.replace(", ","*")),i.changeSymbol()):(r.path("map/"),i.changeSymbol())},o.moreSongs=function(){console.log(),o.start_number=o.start_number+50,o.btnCount++;var e=20*o.btnCount;if(20*o.btnCount+20<o.holder_arr.length)var r=20*o.btnCount+20;else var r=o.holder_arr.length;o.holder_arr.length-20*o.btnCount>1?f.createPlaylist(o.holder_arr).then(function(n){o.songs=n.songs.slice(e,r),o.songs.spot_arr=n.spot_arr.slice(e,r),artistlocation=n.artistlocation.slice(e,r),o.songs.location_arr=n.location_arr.slice(e,r),o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),t.songs_root=o.songs,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr),o.stillLooking=!1,t.loading=!1},function(){o.errorMessage=!0}):1==o.checkForMore&&o.btnCount<20?(n.count=0,t.loading=!0,o.runApp(o.start_number,0,"button",[],o.holder_arr,e,r)):(o.moreHider=!0,o.noMoreSongs=!0),goToByScrollTop("spot_holder")},o.backSongs=function(){o.moreHider=!1,o.noMoreSongs=!1;var e=20*o.btnCount-20,n=20*o.btnCount;f.createPlaylist(o.holder_arr).then(function(r){o.songs=r.songs.slice(e,n),o.songs.spot_arr=r.spot_arr.slice(e,n),artistlocation=r.artistlocation.slice(e,n),o.songs.location_arr=r.location_arr.slice(e,n),o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),t.songs_root=o.songs,o.createMapArtist(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr),o.stillLooking=!1,t.loading=!1,o.btnCount--},function(){o.errorMessage=!0})},o.moreSongsAbout=function(t){if(o.number=o.number+1,o.number*t+t<o.finalcollector.length){o.prevLookUp=!0,o.end_index=o.number*t+t,o.start_index=o.start_index+t,o.lookUpSongs=o.finalcollector.slice(o.start_index,o.end_index),o.lookUpSongs.savSpotArr=o.finalcollector.savSpotArr.slice(o.start_index,o.end_index),o.lookUpSongs.idStr="";for(var e=0;e<o.lookUpSongs.length;e++)o.lookUpSongs.idStr+=o.lookUpSongs[e].id+",";o.lookUpSongs.idStr=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.lookUpSongs.idStr)}else{o.prevLookUp=!0,o.end_index=o.finalcollector.length,o.start_index=o.start_index+t,o.lookUpSongs=o.finalcollector.slice(o.start_index,o.end_index),o.lookUpSongs.savSpotArr=o.finalcollector.savSpotArr.slice(o.start_index,o.end_index),o.lookUpSongs.idStr="";for(var e=0;e<o.lookUpSongs.length;e++)o.lookUpSongs.idStr+=o.lookUpSongs[e].id+",";o.lookUpSongs.idStr=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.lookUpSongs.idStr),o.moreLookUp=!1}goToByScrollTop("spot_holder")},o.prevSongsAbout=function(t){if(o.number=o.number-1,o.number>=0){o.end_index=o.number*t+t,o.start_index=o.end_index-t,o.lookUpSongs=o.finalcollector.slice(o.start_index,o.end_index),o.lookUpSongs.savSpotArr=o.finalcollector.savSpotArr.slice(o.start_index,o.end_index),o.lookUpSongs.idStr="";for(var e=0;e<o.lookUpSongs.length;e++)o.lookUpSongs.idStr+=o.lookUpSongs[e].id+",";if(o.lookUpSongs.idStr=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.lookUpSongs.idStr),0==o.number&&(o.prevLookUp=!1),o.number*t+t<o.finalcollector.length){o.moreLookUp=!0,o.lookUpSongs=o.finalcollector.slice(o.start_index,o.end_index),o.lookUpSongs.savSpotArr=o.finalcollector.savSpotArr.slice(o.start_index,o.end_index),o.lookUpSongs.idStr="";for(var e=0;e<o.lookUpSongs.length;e++)o.lookUpSongs.idStr+=o.lookUpSongs[e].id+",";o.lookUpSongs.idStr=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.lookUpSongs.idStr)}}goToByScrollTop("spot_holder")},o.getSongs=function(t){s.defer();if(void 0==t[0].artist_location){var n=a.location;t[0].artist_location={},e.runLocation(n.replace(/_/g," "),"lat",counter).then(function(r){t[0].artist_location.latitude=r.latitude,e.runLocation(n.replace(/_/g," "),"long",counter).then(function(e){t[0].artist_location.longitude=e.longitude;for(var n=1;n<t.length;n++)t[n].artist_location={},t[n].artist_location.latitude=t[0].artist_location.latitude,t[n].artist_location.longitude=t[0].artist_location.longitude;_.getSongs(t,a.location).then(function(t){_.getLongURL(t).then(function(t){o.long_url=t,_.getBitLy(o.long_url).then(function(t){o.short_url=t,o.shareBox=!0,o.message="Check out my playlist from %23MusicWhereYouAre, a geolocation-based music discovery app. Hows the music where you are? "+o.short_url,o.message_link=encodeURIComponent(o.message)},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})}else _.getSongs(t,a.location).then(function(t){_.getLongURL(t).then(function(t){o.long_url=t.url,"yes"==t.sliced&&(o.tooMany=!0),_.getBitLy(o.long_url).then(function(t){o.short_url=t,o.shareBox=!0,o.message="Check out my playlist from %23MusicWhereYouAre, a geolocation-based music discovery app. Hows the music where you are? "+o.short_url,o.message_link=encodeURIComponent(o.message)},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},o.changeClass=function(t){for(var e=0;e<o.sm_btns.length;e++)o.sm_btns[e].state="off",o.sm_btns[e].classy="hider",o.sm_btns[e].name==t.name?(o.sm_btns[e].state="on",o.sm_btns[e].classy="shower"):(o.sm_btns[e].state="off",o.sm_btns[e].classy="hider")},o.buttons=[{name:"artists",state:"shower",classy:"button_on"},{name:"songs",state:"hider",classy:"button_off"}],o.runButtons=function(t){"artists"==t?(o.fromShower=!0,o.aboutShower=!1,o.shareBox=!1):"songs"==t&&(o.fromShower=!1,o.aboutShower=!0,o.shareBox=!1);for(var e=0;e<o.buttons.length;e++)o.buttons[e].name==t?(o.buttons[e].state="shower",o.buttons[e].classy="button_on"):(o.buttons[e].state="hider",o.buttons[e].classy="button_off")},void 0==a.location)t.loading=!0,p.checkGeoLocation();else{o.location=a.location.replace(/\*/,", ").replace(/_/g," "),o.location_link=a.location,o.tagsArr=[],o.wikiTags=[],t.spot_results=[],t.noSongs=!1,o.latitudeObj={},o.longitudeObj={},o.sharer=!1,o.shareBox=!1,o.sm_btns=[{name:"facebook",state:"on",classy:"shower"},{name:"twitter",state:"off",classy:"hider"},{name:"googleplus",state:"off",classy:"hider"}];o.leaveOut=[],o.location=a.location.replace(/\*/g,", "),o.location_link=a.location;var b=n.count,S=a.location,y=a.location;if(2==S.length)for(var x=u.createStateObj(),k=0;k<x.length;k++)S.toLowerCase()==x[k].abbreviation.toLowerCase()&&(S=x[k].name);void 0!=localStorage.country?(o.wikiTags.push({title:y.split(",")[0],classy:"off"}),o.tagShower=!0,o.runApp(0,1,"",[],o.holder_arr),h.addFavorites()):r.path("country")}}]).controller("Spotify",["$scope","$location","$rootScope","runSymbolChange","$routeParams",function(o){o.songs_arr=[],o.SavePlaylist=function(o,t){var t="MusicWYA: "+t,e="",n="";window.location.href.match("localhost:8888")?(e="2816af78ef834a668eab78a86ec8b4e6",n="http://localhost:8888/MusicWhereYouAre/app/callback.html"):(e="70521c59988a4ff4afa24aabc182b94a",n="http://musicwhereyour.com/callback.html");var r="https://accounts.spotify.com/authorize?client_id="+e+"&response_type=token&scope=playlist-modify-private&redirect_uri="+encodeURIComponent(n);localStorage.setItem("createplaylist-tracks",JSON.stringify(o)),localStorage.setItem("createplaylist-name",t);window.open(r,"asdf","WIDTH=400,HEIGHT=500")}}]),angular.module("Symbol",[]).controller("controlSymbol",["$scope","$location","$rootScope","runSymbolChange",function(o,t,e,n){o.location=t.path().split("/")[2],void 0==o.location&&(o.location=""),o.hideIcons=!1,o.genre_class={},o.playlist_class={},o.favorite_class={},o.map_class={},o.jukebox_class={},o.roadsoda_class={},o.calendar_class={},o.playlist_class.name="playlist",o.playlist_class.classy="icon-song",o.playlist_class.state="off",o.playlist_class.href="#/playlist/"+o.location,o.genre_class.name="genre",o.genre_class.classy="iconequalizer12",o.genre_class.state="off",o.genre_class.href="#/genres/"+o.location,o.favorite_class.name="favorite",o.favorite_class.classy="iconfavorite",o.favorite_class.state="off",o.favorite_class.href="#/favorites/"+o.location,o.map_class.name="map",o.map_class.classy="iconmap",o.map_class.state="off",o.map_class.href="#/map/"+o.location,o.jukebox_class.name="jukebox",o.jukebox_class.classy="jukebox",o.jukebox_class.state="off",o.jukebox_class.href="#/jukebox/"+o.location,o.roadsoda_class.name="roadsoda",o.roadsoda_class.classy="roadsoda",o.roadsoda_class.state="off",o.roadsoda_class.href="#/roadsoda/"+o.location,o.calendar_class.name="calendar",o.calendar_class.classy="calendar",o.calendar_class.state="off",o.calendar_class.href="#/calendar/"+o.location,o.icons=[o.genre_class,o.playlist_class,o.favorite_class,o.map_class,o.jukebox_class,o.calendar_class],e.icons=o.icons,n.changeSymbol(),o.changeMenu=function(){1==o.menuPos?o.menuPos=!1:(o.menuPos=!0,t.path("map/"+o.location.replace(", ","*")))},o.changeClass=function(e,n,r,a,s){o.location=t.path().split("/")[2];t.path().split("/")[2];"on"==e?(n.state="off",n.href="#/map/"+o.location):(n.state="on",n.href="#/"+s+"/"+o.location);for(var i=0;i<o.icons.length;i++)o.icons[i].name!=n.name&&(o.icons[i].state="off")},o.goBack=function(){t.path("map/"+o.location.replace(", ","*")),n.changeSymbol()},o.toggleIcons=function(){o.hideIcons=1==o.hideIcons?!1:!0}}]).controller("error",["$rootScope",function(o){o.noSongs=!0}]),angular.module("Info",[]).controller("loadInfo",["$scope","$location","$rootScope","runSymbolChange","$routeParams","retrieveInfo","retrieveLocation","LocationDataFetch","PlaylistCreate","Spotify","Wiki","ChunkSongs","$sce",function(o,t,e,n,r,a,s,i,l,c,g,u,d){e.noGeo=!1,localStorage.path=t.path(),e.loading=!0,o.buttons=a.createObjects(),o.buttonsArr=[o.buttons.bio,o.buttons.photos,o.buttons.videos,o.buttons.topsongs,o.buttons.news,o.buttons.related],o.location=r.location.replace(/\*/,", "),o.location_link=r.location,o.name=removeSpecialChar(r.artist),o.artistdata=!1;var h=[];o.tabs=a.createObjects(),a.infoRetrieve(o.name).then(function(t){o.artistinfo=t,o.artistinfo.bioCheck=!0,o.artistinfo.photosCheck=!0,o.artistinfo.newsCheck=!0,o.artistinfo.videoCheck=!0,0==o.artistinfo.bio.length&&(o.artistinfo.bioCheck=!1),0==o.artistinfo.video.length&&(o.artistinfo.videoCheck=!1),0==o.artistinfo.news.length&&(o.artistinfo.newsCheck=!1),o.artistinfo.images.length<1&&(o.artistinfo.photosCheck=!1),a.relatedRetrieve(o.name).then(function(t){o.relatedartists=t.data.response.artists}),o.artistdata=!0,s.runLocation(replacePatterns(o.location),e.genres),a.lookUpArtist(o.name).then(function(t){void 0!=t?(o.artist_lookup=t.data.artists.items[0].id,a.spotifyRetrieve(o.artist_lookup).then(function(t){o.spotify=t.data,e.loading=!1,o.noArtist=!1
})):(o.noArtist=!0,e.loading=!1)},function(){o.ErrorMessage=!0})}),o.changeClass=function(t,e){for(var n=0;n<o.buttonsArr.length;n++)o.buttonsArr[n].name==e.name?(o.buttonsArr[n].state="on",o.buttonsArr[n].classy="shower"):(o.buttonsArr[n].state="off",o.buttonsArr[n].classy="hider");goToByScrollLeft("boxes")},o.goBack=function(){t.path("playlist/"+o.location.replace(", ","*")),n.changeSymbol()},o.lookUpArtist=function(o){var e=r.location;t.path("info/"+e+"/"+o.replace("The ",""))},o.runApp=function(n,a,g,_,p,f,m){if(void 0==_)var _=[];else var _=_;o.holder_arr=void 0==p?[]:p,o.index1=void 0==f?0:f,o.index2=void 0==m?20:m,e.mapOpening=!0;var _=[];o.songs=[],o.songs.spot_arr=[],o.spot_arr=[],o.savSpotArr=[],o.location_arr=[],o.final_loc_arr=[];r.location;o.ratio=.15*a,o.start_number=n,o.holder_arr=[];var v=[];s.runLocation(replacePatterns(o.location),"lat",a).then(function(n){o.latitudeObj=n,e.latitudeObj_root=n,o.latitude=o.latitudeObj.latitude,s.runLocation(replacePatterns(o.location),"long",a).then(function(n){e.longitudeObj_root={},o.longitudeObj=n,e.longitudeObj_root=n,o.longitude=o.longitudeObj.longitude,o.geolocation=[o.latitudeObj,o.longitudeObj];{var s=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),g=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_min);(o.latitudeObj.lat_max+o.latitudeObj.lat_min)/2,(o.longitudeObj.long_max+o.longitudeObj.long_min)/2}if(s>g)var p=s;else var p=g;o.zoom=r.location.split("*").length>1?c.runRange(p):6,e.mapOpening=!0,o.counter=a,o.counter=a;for(var f=0;2>f;f++){l.runPlaylist(o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.latitudeObj.lat_min,o.latitudeObj.lat_max,o.longitudeObj.long_min,o.longitudeObj.long_max,e.genres,e.era,o.start_number).then(function(n){if(_=_.concat(n),v.push(f),v.length==f)if(0==n.songsArr.length&&o.holder_arr.length>0){e.loading=!1,o.btnCount>0?(o.noMoreSongs=!0,o.moreHider=!0):(o.noMoreSongs=!1,o.moreHider=!1),o.donesy=!0;{o.holder_arr.length-20,o.holder_arr.length}c.createPlaylist(o.holder_arr).then(function(t){o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),e.songs_root=o.songs,c.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){i.count=1,e.mapdata=t,o.stillLooking=!1,e.loading=!1,e.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0})}else _.length<100&&o.counter<=5?(o.counter=o.counter+1,1==e.marked?(o.moreHider=!0,o.loading=!1,o.noMoreSongs=!0):o.counter<=5&&n.songsArr.length>0?(o.counter>3&&(o.stillLooking=!0),o.start_number=o.start_number+50,i.count=0,o.runApp(o.start_number,o.counter,"",_,o.holder_arr)):0==_.length?e.noSongs=!0:_.length<=50&&(o.counter>=6||0==n.songsArr.length)?c.checkSongMarket(_).then(function(t){for(var n=[],r=0;r<t.length;r++)n.push(r),h.push(t[r]),n.length==t.length&&(o.holder_songs={},o.holder_arr=h,e.holder_arr_root=o.holder_arr,o.holder_arr.length<=20&&(o.moreHider=!0),c.createPlaylist(h).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),e.songs_root=o.songs,c.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){i.count=1,e.mapdata=t,o.stillLooking=!1,e.loading=!1,e.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))}):_.length>50&&_.length<100&&o.counter>=6&&u.createChunks(_,50).then(function(t){for(var n=[],r=[],a=0;a<t.length;a++)n.push(a),c.checkSongMarket(t[a].songs).then(function(a){for(var s=0;s<a.length;s++)r.push(s),h.push(a[s]),n.length==t.length&&r.length==a.length&&(o.holder_songs={},o.holder_arr=h,e.holder_arr_root=o.holder_arr,c.createPlaylist(h).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),e.songs_root=o.songs,c.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){i.count=1,e.mapdata=t,o.stillLooking=!1,e.loading=!1,e.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0})):_.length>50&&(0==o.donesy||void 0==o.donesy)?u.createChunks(_,50).then(function(t){for(var n=[],r=[],a=0;a<t.length;a++)n.push(a),c.checkSongMarket(t[a].songs).then(function(a){for(var s=0;s<a.length;s++)r.push(s),h.push(a[s]),n.length==t.length&&r.length==a.length&&(o.holder_songs={},o.holder_arr=h,e.holder_arr_root=h,a.length%20>0&&o.counter<2&&o.holder_arr.length<150?(o.counter++,i.count=0,o.runApp(o.start_number,o.counter,"",[],o.holder_arr)):c.createPlaylist(h).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=d.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),e.songs_root=o.songs,c.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){i.count=1,e.mapdata=t,o.stillLooking=!1,e.loading=!1,e.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0}):0==_.length&&(e.noSongs=!0,t.path("#/map"))},function(){o.errorMessage=!0})}})})},o.location=r.location.replace(/\*/,", ").replace(/_/g," "),o.location_link=r.location,(1==e.mapOpening||1e11==i.count)&&o.runApp(0,1)}]),angular.module("Genre",[]).controller("GenreController",["$scope","$routeParams","retrieveLocation","LocationDataFetch","PlaylistCreate","MapCreate","$location","$rootScope","$q","loadGenreCheckData","runSymbolChange","getLocation","Spotify","$sce","Wiki","ChunkSongs",function(o,t,e,n,r,a,s,i,l,c,g,u,d,h,_,p){i.noGeo=!1,null==sessionStorage.genre||0==sessionStorage.genre?(o.showGenreMessage=!0,sessionStorage.genre=!1):(o.showGenreMessage=!1,sessionStorage.genre=!0),o.buttons=[{name:"genres",state:"shower",classy:"button_on"},{name:"eras",state:"hider",classy:"button_off"},{name:"moods",state:"hider",classy:"button_off"}],o.noPickedGenre=!1,o.songs=[];var f=[];o.songs.spot_arr=[],o.spot_arr=[],o.location_arr=[],o.final_loc_arr=[];null==i.genreSans&&(i.genreSans=[]),o.runButtons=function(t){for(var e=0;e<o.buttons.length;e++)o.buttons[e].name==t?(o.buttons[e].state="shower",o.buttons[e].classy="button_on"):(o.buttons[e].state="hider",o.buttons[e].classy="button_off")},o.Genre=c.getGenre(),o.avant_garde=o.Genre[0].genre,o.blues=o.Genre[1].genre,o.classic_rock=o.Genre[2].genre,o.classical=o.Genre[3].genre,o.comedy=o.Genre[4].genre,o.country=o.Genre[5].genre,o.drama=o.Genre[6].genre,o.electronic=o.Genre[7].genre,o.folk=o.Genre[8].genre,o.hip_hop=o.Genre[9].genre,o.holiday=o.Genre[10].genre,o.indie=o.Genre[11].genre,o.jazz=o.Genre[12].genre,o.kid_music=o.Genre[13].genre,o.latin=o.Genre[14].genre,o.new_age=o.Genre[15].genre,o.motown=o.Genre[16].genre,o.pop=o.Genre[17].genre,o.rock=o.Genre[18].genre,o.soft_rock=o.Genre[19].genre,o.world=o.Genre[20].genre,o.location=void 0!=t.location?t.location.replace(/\*/,", ").replace(/_/g," "):"",o.genre_hash="",o.Era=c.getEra(),o.Era.twentyten=o.Era[0].era,o.Era.twenty=o.Era[1].era,o.Era.nineteenninty=o.Era[2].era,o.Era.nineteenteighty=o.Era[3].era,o.Era.nineteenseventy=o.Era[4].era,o.Era.nineteensixty=o.Era[5].era,o.Era.nineteenfifty=o.Era[6].era,o.Era.nineteenforty=o.Era[7].era,o.Era.nineteenthirty=o.Era[8].era,o.Era.nineteentwenty=o.Era[9].era,o.Era.nineteenten=o.Era[10].era,o.Era.nineteen=o.Era[11].era,o.Era.eighteenninty=o.Era[12].era,o.Era.eighteeneighty=o.Era[13].era,o.Era.eighteenseventy=o.Era[14].era,o.Era.eighteensixty=o.Era[15].era,o.range_message=!1,o.selectera=!1,o.selectmood=!1;var m=new Date;o.d=m.getFullYear(),(""==i.start_year||null==i.start_year)&&(o.start_year=1890),""==i.end_year||null==i.end_year?o.end_year=o.d:(o.end_year=i.end_year,o.start_year=i.start_year),o.runApp=function(t,a,l,c,g,u,_){if(void 0==c)var c=[];else var c=c;o.holder_arr=void 0==g?[]:g,o.index1=void 0==u?0:u,o.index2=void 0==_?20:_,"button"==l&&(f=[]);var m=[];n.count=1,i.mapOpening=!0,o.start_number=t,o.counter=a,o.ratio=.15*a,i.holder=[],i.count_about=0,i.moreLookUp=!1,e.runLocation(replacePatterns(o.location),"lat",a).then(function(t){o.latitudeObj=t,i.latitudeObj_root=t,i.latitude=0,o.latitude=o.latitudeObj.latitude,e.runLocation(replacePatterns(o.location),"long",a).then(function(t){i.longitudeObj_root={},o.longitudeObj=t,i.longitudeObj_root=t,o.longitude=o.longitudeObj.longitude,o.geolocation=[o.latitudeObj,o.longitudeObj];var e=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),l=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_max);if(e>l)var g=e;else var g=l;o.zoom=d.runRange(g),o.counter=a;for(var u=0;2>u;u++){r.runPlaylist(o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.latitudeObj.lat_min,o.latitudeObj.lat_max,o.longitudeObj.long_min,o.longitudeObj.long_max,i.genres,i.era,o.start_number).then(function(t){if(c=c.concat(t),m.push(u),m.length==u)if(0==t.songsArr.length&&o.holder_arr.length>0){i.loading=!1,o.btnCount>0?(o.noMoreSongs=!0,o.moreHider=!0):(o.noMoreSongs=!1,o.moreHider=!1),o.donesy=!0;{o.holder_arr.length-20,o.holder_arr.length}d.createPlaylist(o.holder_arr).then(function(t){o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.spot_strFinal=h.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),i.songs_root=o.songs,d.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){n.count=1,i.mapdata=t,o.stillLooking=!1,i.loading=!1,i.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0})}else c.length<100&&o.counter<=5?(o.counter=o.counter+1,1==i.marked?(o.moreHider=!0,o.loading=!1,o.noMoreSongs=!0):o.counter<=5&&t.songsArr.length>0?(o.counter>3&&(o.stillLooking=!0),o.start_number=o.start_number+50,n.count=0,o.runApp(o.start_number,o.counter,"",c,o.holder_arr)):0==c.length?i.noSongs=!0:c.length<=50&&(o.counter>=6||0==t.songsArr.length)?d.checkSongMarket(c).then(function(t){for(var e=[],r=0;r<t.length;r++)e.push(r),f.push(t[r]),e.length==t.length&&(o.holder_songs={},o.holder_arr=f,i.holder_arr_root=o.holder_arr,o.holder_arr.length<=20&&(o.moreHider=!0),d.createPlaylist(f).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=h.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),i.songs_root=o.songs,d.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){n.count=1,i.mapdata=t,o.stillLooking=!1,i.loading=!1,i.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))}):c.length>50&&c.length<100&&o.counter>=6&&p.createChunks(c,50).then(function(t){for(var e=[],r=[],a=0;a<t.length;a++)e.push(a),d.checkSongMarket(t[a].songs).then(function(a){for(var s=0;s<a.length;s++)r.push(s),f.push(a[s]),e.length==t.length&&r.length==a.length&&(o.holder_songs={},o.holder_arr=f,i.holder_arr_root=o.holder_arr,d.createPlaylist(f).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=h.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),i.songs_root=o.songs,d.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){n.count=1,i.mapdata=t,o.stillLooking=!1,i.loading=!1,i.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0})):c.length>50&&(0==o.donesy||void 0==o.donesy)?p.createChunks(c,50).then(function(t){for(var e=[],r=[],a=0;a<t.length;a++)e.push(a),d.checkSongMarket(t[a].songs).then(function(a){for(var s=0;s<a.length;s++)r.push(s),f.push(a[s]),e.length==t.length&&r.length==a.length&&(o.holder_songs={},o.holder_arr=f,i.holder_arr_root=f,a.length%20>0&&o.counter<2&&o.holder_arr.length<150?(o.counter++,n.count=0,o.runApp(o.start_number,o.counter,"",[],o.holder_arr)):d.createPlaylist(f).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=h.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),i.songs_root=o.songs,d.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){n.count=1,i.mapdata=t,o.stillLooking=!1,i.loading=!1,i.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0}):0==c.length&&(i.noSongs=!0,s.path("#/map"))},function(){o.errorMessage=!0})}},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},o.checkGenre=function(t){i.noSongs=!1;for(var e=0;e<o.Genre.length;e++)if(t==o.Genre[e].genre.genre&&"off"==o.Genre[e].genre.state){o.Genre[e].genre.state="on",i.genres+="****"+o.Genre[e].genre.similarGenres;for(var n=0;n<o.Genre[e].genre.similarGenres.split("**").length;n++)i.genreSans.push(o.Genre[e].genre.similarGenres.split("**")[n])}else if(t==o.Genre[e].genre.genre&&"on"==o.Genre[e].genre.state){o.Genre[e].genre.state="off";for(var r=i.genres.split("**"),a=0;a<r.length;a++){var l=i.genreSans.indexOf(r[a]);l>-1&&i.genreSans.splice(l,1)}i.genres=""}else if("on"==o.Genre[e].genre.state){i.genres+="****"+o.Genre[e].genre.similarGenres;for(var n=0;n<o.Genre[e].genre.similarGenres.split("**").length;n++)i.genreSans.push(o.Genre[e].genre.similarGenres.split("**")[n])}""==i.genres&&(i.genres="****"),o.genre_str+=i.genres,o.location=o.location.replace(/\*/g,", "),void 0!=localStorage.country?o.runApp(0,1,"button"):(i.new_location=s.path(),s.path("country")),o.genre_hash=s.path()+"/"+i.genres},o.checkEra=function(t,e){i.noSongs=!1,o.start_year=t,o.end_year=e,i.start_year=t,i.end_year=e;var n=new Date;o.d=n.getFullYear(),e>t?i.era=void 0==t?"&aritist_end_year_before="+e:void 0==e?"&artist_start_year_after="+t:""==e?"&artist_start_year_after="+t:""==t?"&artist_end_year_before="+e+"&artist_start_year_after=1890":e==o.d?"&artist_start_year_after="+t:"&artist_end_year_before="+e+"&artist_start_year_after="+t:o.range_message=!0,o.era_str+=i.era,o.location=o.location.replace(/\*/g,", "),o.runApp(0,1,"button"),o.era_hash=s.path()+"/"+i.genres},o.goBack=function(){s.path("playlist/"+o.location.replace(", ","*")),g.changeSymbol()},o.lookUpGenre=function(t){o.noPickedGenre=!1,c.loadEchonestStyles().then(function(e){var n=e;n.push({name:"holiday"});var r=[];if(t.match(", "))var r=t.split(", ");else r=[t];for(var a=0;a<n.length;a++)for(var s=0;s<r.length;s++)n[a].name.toLowerCase()==r[s].replace().toLowerCase()&&(i.genres+="**"+r[s],i.genreSans.push(r[s]),o.noPickedGenre=!1,o.runApp(0,1,"button"));0==i.genres.length&&(o.noPickedGenre=!0),o.genre=""})},o.toggleGenre=function(t){var e=i.genreSans.indexOf(t);e>-1&&i.genreSans.splice(e,1);for(var n=0;n<o.Genre.length;n++)i.genreSans.toString().match(o.Genre[n].genre.genre)||(o.Genre[n].genre.checked=!1);i.genreSans.length>0?(i.genres="****"+i.genreSans.toString().replace(/,/g,"**"),o.runApp(0,1,"button")):(i.genres="",o.runApp(0,1,"button"))},o.close=function(){o.noCountry=!1,localStorage.setItem("country",""),s.path(localStorage.path),n.count=0},o.setCountry=function(t){localStorage.country=t,localStorage.setItem("country",t),o.noCountry=!1,s.path(localStorage.path),n.count=0},o.showResetMessage=function(){},o.resetCountry=function(){localStorage.removeItem("country"),o.noCountry=!0},o.country="",void 0==localStorage.country&&(o.noCountry=!0);for(var v=0;v<o.Genre.length;v++){o.Genre[v].genre.state="off";for(var b=0;b<i.genres.split("***").length;b++)i.genres.split("***")[b].replace("*","")==o.Genre[v].genre.similarGenres&&(o.Genre[v].genre.checked=!0,o.Genre[v].genre.isSelected=!0,o.Genre[v].genre.state="on")}void 0!==t.genre&&(i.genres=t.genre),g.changeSymbol(),void 0==t.location?(i.loading=!0,o.location="Finding your location...",u.checkGeoLocation()):(o.location=t.location.replace(/\*/,", ").replace(/_/g," "),o.location_link=t.location,(1==i.mapOpening||1e11==n.count)&&o.runApp(0,1,o.holder_arr))}]);var FavoritesControllers=angular.module("FavoritesControllers",[]);FavoritesControllers.controller("LoadFav",["$scope","$q","$http","runSymbolChange","$routeParams","$location","$sce","retrieveLocation","PlaylistCreate","MapCreate","$rootScope","Favorites","ShareSongs","getLocation","Spotify","LocationDataFetch","Wiki","ChunkSongs",function(o,t,e,n,r,a,s,i,l,c,g,u,d,h,_,p,f,m){g.noGeo=!1;o.sharer=!1,o.shareBox=!1,o.tooMany=!1,o.sm_btns=[{name:"facebook",state:"on",classy:"shower"},{name:"twitter",state:"off",classy:"hider"},{name:"googleplus",state:"off",classy:"hider"}],o.location=r.location,o.leaveOut=[],o.d=new Date,o.date=o.date=o.d.getMonth()+1+"/"+o.d.getDate()+"/"+o.d.getFullYear(),o.start_number=0;var v=jQuery.parseJSON(localStorage.FavoriteArr);o.moreHider=!0,o.backHider=!0,o.viewall=!1;var b=[];o.songs=[],u.addFavorites(),o.runApp=function(t,e,n,c,u,d,h){if(void 0==c)var c=[];else var c=c;o.holder_arr=void 0==u?g.holder_arr_root:u,o.index1=void 0==d?0:d,o.index2=void 0==h?20:h;var f=[];g.mapOpening=!0,o.songs=[],o.songs.spot_arr=[],o.spot_arr=[],o.savSpotArr=[],o.location_arr=[],o.final_loc_arr=[];r.location;o.ratio=.15*e,o.start_number=t,i.runLocation(replacePatterns(o.location),"lat",e).then(function(t){o.latitudeObj=t,g.latitudeObj_root=t,o.latitude=o.latitudeObj.latitude,i.runLocation(replacePatterns(o.location),"long",e).then(function(t){g.longitudeObj_root={},o.longitudeObj=t,g.longitudeObj_root=t,o.longitude=o.longitudeObj.longitude,o.geolocation=[o.latitudeObj,o.longitudeObj];{var n=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),i=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_min);(o.latitudeObj.lat_max+o.latitudeObj.lat_min)/2,(o.longitudeObj.long_max+o.longitudeObj.long_min)/2}if(n>i)var u=n;else var u=i;o.zoom=r.location.split("*").length>1?_.runRange(u):6,o.counter=e;for(var d=0;2>d;d++){l.runPlaylist(o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.latitudeObj.lat_min,o.latitudeObj.lat_max,o.longitudeObj.long_min,o.longitudeObj.long_max,g.genres,g.era,o.start_number).then(function(t){if(c=c.concat(t),f.push(d),f.length==d)if(0==t.songsArr.length&&o.holder_arr.length>0){g.loading=!1,o.btnCount>0?(o.noMoreSongs=!0,o.moreHider=!0):(o.noMoreSongs=!1,o.moreHider=!1),o.donesy=!0;{o.holder_arr.length-20,o.holder_arr.length}_.createPlaylist(o.holder_arr).then(function(t){o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,_.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){p.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0})}else c.length<100&&o.counter<=5?(o.counter=o.counter+1,1==g.marked?(o.moreHider=!0,o.loading=!1,o.noMoreSongs=!0):o.counter<=5&&t.songsArr.length>0?(o.counter>3&&(o.stillLooking=!0),o.start_number=o.start_number+50,p.count=0,o.runApp(o.start_number,o.counter,"",c,o.holder_arr)):0==c.length?g.noSongs=!0:c.length<=50&&(o.counter>=6||0==t.songsArr.length)?_.checkSongMarket(c).then(function(t){for(var e=[],n=0;n<t.length;n++)e.push(n),b.push(t[n]),e.length==t.length&&(o.holder_songs={},o.holder_arr=b,g.holder_arr_root=o.holder_arr,o.holder_arr.length<=20&&(o.moreHider=!0),_.createPlaylist(b).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,_.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){p.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))}):c.length>50&&c.length<100&&o.counter>=6&&m.createChunks(c,50).then(function(t){for(var e=[],n=[],r=0;r<t.length;r++)e.push(r),_.checkSongMarket(t[r].songs).then(function(r){for(var a=0;a<r.length;a++)n.push(a),b.push(r[a]),e.length==t.length&&n.length==r.length&&(o.holder_songs={},o.holder_arr=b,g.holder_arr_root=o.holder_arr,_.createPlaylist(b).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,_.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){p.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0})):c.length>50&&(0==o.donesy||void 0==o.donesy)?m.createChunks(c,50).then(function(t){for(var e=[],n=[],r=0;r<t.length;r++)e.push(r),_.checkSongMarket(t[r].songs).then(function(r){for(var a=0;a<r.length;a++)n.push(a),b.push(r[a]),e.length==t.length&&n.length==r.length&&(o.holder_songs={},o.holder_arr=b,g.holder_arr_root=b,r.length%20>0&&o.counter<2&&o.holder_arr.length<150?(o.counter++,p.count=0,o.runApp(o.start_number,o.counter,"",[],o.holder_arr)):_.createPlaylist(b).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,_.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){p.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0}):0==c.length&&(g.noSongs=!0,a.path("#/map"))},function(){o.errorMessage=!0})}},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},o.switchFavorite=function(t,e){var n=[];if(null!=localStorage.getItem("FavoriteArr")&&""!=localStorage.getItem("FavoriteArr"))var r=jQuery.parseJSON(localStorage.FavoriteArr);else var r=[];for(var a=0;a<r.length;a++)n.push(o.songsFav[e].id);var s=e;r.splice(s,1),localStorage.setItem("FavoriteArr",JSON.stringify(r)),o.songsFav[e].favorite="off",o.songsFav[e].closeButton=!0,o.songsFav.length<1&&(o.getFav=!1)},o.goBack=function(){a.path("map/"+o.location.replace(", ","*")),n.changeSymbol()},o.moreSongs=function(t,e){if(o.songs=[],o.start_number=o.start_number,o.start_number=t,o.start_number-25<0){o.start_number=0;var e=e}if(v.length>25&&(o.backHider=o.start_number>0?!1:!0,o.moreHider=!1),o.start_number+25>v.length){var e=v.length;o.moreHider=!0}else o.start_number=o.start_number;for(var n=o.start_number;e>n;n++)o.songs.push(v[n]);goToByScrollTop("fav_holder")},o.viewAll=function(){o.songs=[],o.viewall=!0,o.moreSongs(0,v.length),o.moreHider=!0,o.backHider=!0,o.sharer=!0},o.view25=function(){o.songs=[],o.viewall=!1,o.moreSongs(0,25),o.moreHider=!1,o.sharer=!1},o.getSongs=function(){d.getSongs(o.songsFav,r.location).then(function(t){d.getLongURL(t).then(function(t){o.long_url=t.url,"yes"==t.sliced&&(o.tooMany=!0),d.getBitLy(o.long_url).then(function(t){o.short_url=t,o.shareBox=!0,o.message="Check out my playlist from %23MusicWhereYouAre, a geolocation-based music discovery app. Hows the music where you are? "+o.short_url,o.message_link=encodeURIComponent(o.message)},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},o.closeShareBox=function(){o.sharer=!1,o.shareBox=!1},o.changeClass=function(t){for(var e=0;e<o.sm_btns.length;e++)o.sm_btns[e].state="off",o.sm_btns[e].classy="hider",o.sm_btns[e].name==t.name?(o.sm_btns[e].state="on",o.sm_btns[e].classy="shower"):(o.sm_btns[e].state="off",o.sm_btns[e].classy="hider")},void 0==r.location?(g.loading=!0,o.location="Finding your location...",h.checkGeoLocation()):(o.location=r.location.replace(/\*/,", ").replace(/_/g," "),o.location_link=r.location,g.loading=!0,o.runApp(0,1)),o.songsFav=[],o.save_arr=[],o.songs_repeater=jQuery.parseJSON(localStorage.getItem("FavoriteArr"));var S=localStorage.getItem("FavoriteArr");null==S&&(S=[]),(2==S.length||null==S)&&(o.getFav=!1,localStorage.setItem("FavoriteArr","[]"));var y="";if(null!=o.songs_repeater)for(var x=0;x<o.songs_repeater.length;x++)y.replace(/\W/g,"").match(o.songs_repeater[x].id.replace(/\W/g,""))||o.songsFav.push(o.songs_repeater[x]),y+=o.songs_repeater[x].id;if(o.spot_arr=[],null!=o.songsFav){o.songsFav.spot_str="";for(var x=0;x<o.songsFav.length;x++)o.spot_arr.push(o.songsFav[x].id),o.save_arr.push("spotify:track:"+o.songsFav[x].id),o.songsFav[x].favorite="on";o.songsFav.spot_str="https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.spot_arr.toString(),o.songsFav.spot_str=s.trustAsResourceUrl(o.songsFav.spot_str)}else o.songsFav=[],o.songsFav.spot_str="";o.location_link=r.location}]);var Events=angular.module("Events",[]);Events.controller("LoadEvents",["$scope","$q","$http","runSymbolChange","$routeParams","$location","$sce","retrieveLocation","PlaylistCreate","MapCreate","$rootScope","Events","getLocation","Spotify","LocationDataFetch","Wiki","ChunkSongs",function(o,t,e,n,r,a,s,i,l,c,g,u,d,h,_,p,f){g.noGeo=!1;var m=[];o.runApp=function(t,e,n,c,u,d,p){if(void 0==c)var c=[];else var c=c;o.holder_arr=void 0==u?[]:u,o.index1=void 0==d?0:d,o.index2=void 0==p?20:p;var v=[];g.mapOpening=!0,o.songs=[],o.songs.spot_arr=[],o.spot_arr=[],o.savSpotArr=[],o.location_arr=[],o.final_loc_arr=[];r.location;o.ratio=.15*e,o.start_number=t,i.runLocation(replacePatterns(o.location),"lat",e).then(function(t){o.latitudeObj=t,g.latitudeObj_root=t,o.latitude=o.latitudeObj.latitude,i.runLocation(replacePatterns(o.location),"long",e).then(function(t){g.longitudeObj_root={},o.longitudeObj=t,g.longitudeObj_root=t,o.longitude=o.longitudeObj.longitude,o.geolocation=[o.latitudeObj,o.longitudeObj];{var n=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),i=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_min);(o.latitudeObj.lat_max+o.latitudeObj.lat_min)/2,(o.longitudeObj.long_max+o.longitudeObj.long_min)/2}if(n>i)var u=n;else var u=i;o.zoom=r.location.split("*").length>1?h.runRange(u):6,o.counter=e;for(var d=0;2>d;d++){var p=50*d;l.runPlaylist(o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.latitudeObj.lat_min,o.latitudeObj.lat_max,o.longitudeObj.long_min,o.longitudeObj.long_max,g.genres,g.era,p).then(function(t){if(c=c.concat(t),v.push(d),v.length==d&&v.length==d)if(0==t.songsArr.length&&o.holder_arr.length>0){g.loading=!1,o.btnCount>0?(o.noMoreSongs=!0,o.moreHider=!0):(o.noMoreSongs=!1,o.moreHider=!1),o.donesy=!0;{o.holder_arr.length-20,o.holder_arr.length}h.createPlaylist(o.holder_arr).then(function(t){o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){_.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0,o.runEvents(g.latitudeObj_root.latitude,g.longitudeObj_root.longitude)})},function(){o.errorMessage=!0})}else c.length<100&&o.counter<=5?(o.counter=o.counter+1,1==g.marked?(o.moreHider=!0,o.loading=!1,o.noMoreSongs=!0):o.counter<=5&&t.songsArr.length>0?(o.counter>3&&(o.stillLooking=!0),o.start_number=o.start_number+50,_.count=0,o.runApp(o.start_number,o.counter,"",c,o.holder_arr)):0==c.length?g.noSongs=!0:c.length<=50&&(o.counter>=6||0==t.songsArr.length)?h.checkSongMarket(c).then(function(t){for(var e=[],n=0;n<t.length;n++)e.push(n),m.push(t[n]),e.length==t.length&&(o.holder_songs={},o.holder_arr=m,g.holder_arr_root=o.holder_arr,o.holder_arr.length<=20&&(o.moreHider=!0),h.createPlaylist(m).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){_.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0,o.runEvents(g.latitudeObj_root.latitude,g.longitudeObj_root.longitude)
})},function(){o.errorMessage=!0}))}):c.length>50&&c.length<100&&o.counter>=6&&f.createChunks(c,50).then(function(t){for(var e=[],n=[],r=0;r<t.length;r++)e.push(r),h.checkSongMarket(t[r].songs).then(function(r){for(var a=0;a<r.length;a++)n.push(a),m.push(r[a]),e.length==t.length&&n.length==r.length&&(o.holder_songs={},o.holder_arr=m,g.holder_arr_root=o.holder_arr,h.createPlaylist(m).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){_.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0})):c.length>50&&(0==o.donesy||void 0==o.donesy)?f.createChunks(c,50).then(function(t){for(var e=[],n=[],r=0;r<t.length;r++)e.push(r),h.checkSongMarket(t[r].songs).then(function(r){for(var a=0;a<r.length;a++)n.push(a),m.push(r[a]),e.length==t.length&&n.length==r.length&&(o.holder_songs={},o.holder_arr=m,g.holder_arr_root=m,r.length%20>0&&o.counter<2&&o.holder_arr.length<150?(o.counter++,_.count=0,o.runApp(o.start_number,o.counter,"",[],o.holder_arr)):h.createPlaylist(m).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){_.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0,o.runEvents(g.latitudeObj_root.latitude,g.longitudeObj_root.longitude)})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0}):0==c.length&&(g.noSongs=!0,a.path("#/map"))},function(){o.errorMessage=!0})}},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},o.goBack=function(){a.path("playlist/"+o.location.replace(", ","*")),n.changeSymbol()},void 0==r.location?(r.location="Finding your location",o.location="Finding your location...",d.checkGeoLocation()):(o.location=r.location.replace(/\*/,", ").replace(/_/g," "),o.location_link=r.location,1==g.loading&&o.runApp(0,1)),o.runEvents=function(t,e){o.eventData=!1,o.loadingEvents=!0,u.getGeoEvents(t,e).then(function(t){if(JSON.stringify(t).match("We could not find any upcoming events based on your specified location"))o.noShows=!0;else{o.noShows=!1,"array"!=typeof t.data.events.event?(o.events=[],o.events.push(t.data.events.event)):o.events=t.data.events.event,o.events=t.data.events.event;for(var e=0;e<o.events.length;e++)"string"==typeof o.events[e].artists.artist&&(o.events[e].artists.artist=[o.events[e].artists.artist]),o.date=new Date(o.events[e].startDate),o.hours=o.date.getHours(),o.fin_hours=o.date.getHours()+2,o.month=o.date.getMonth()+1,void 0!=o.events[e].tags&&void 0!=o.events[e].tags.tag&&(o.events[e].tagsStr=o.events[e].tags.tag.toString().replace(/,/g,", ")),o.hours.toString().length<2&&(o.hours="0"+o.hours),o.fin_hours.toString().length<2&&(o.fin_hours="0"+o.fin_hours),o.month.toString().length<2&&(o.month="0"+o.month),o.events[e].date=o.date.getFullYear()+""+o.month+o.date.getDate()+"T"+o.hours+"0000/"+o.date.getFullYear()+o.month+o.date.getDate()+"T"+o.fin_hours+"0000"}o.eventData=!0,o.loadingEvents=!1},function(){o.errorMessage=!0})},1==g.mapOpening||1e11==_.count?o.runApp(0,1):(o.loadingEvents=!0,o.runEvents(g.latitudeObj_root.latitude,g.longitudeObj_root.longitude))}]),Events.controller("LoadBandEvents",["$scope","$q","$http","runSymbolChange","$routeParams","$location","$sce","retrieveLocation","PlaylistCreate","MapCreate","$rootScope","Events","LocationDataFetch","Spotify","Wiki","ChunkSongs",function(o,t,e,n,r,a,s,i,l,c,g,u,d,h,_,p){g.noGeo=!1,o.location=r.location.replace(/\*/,", ").replace(/_/g," "),o.location_link=r.location,o.artist=a.path().split("/")[3],g.loading=!0;var f=[];o.songs={},o.runApp=function(t,e,n,c,u,_,m){if(void 0==c)var c=[];else var c=c;o.holder_arr=void 0==u?[]:u,o.index1=void 0==_?0:_,o.index2=void 0==m?20:m;var v=[];o.songs=[],o.songs.spot_arr=[],o.spot_arr=[],o.savSpotArr=[],o.location_arr=[],o.final_loc_arr=[];r.location;o.ratio=.15*e,o.start_number=t,o.holder_arr=[],i.runLocation(replacePatterns(o.location),"lat",e).then(function(t){o.latitudeObj=t,g.latitudeObj_root=t,o.latitude=o.latitudeObj.latitude,i.runLocation(replacePatterns(o.location),"long",e).then(function(t){g.longitudeObj_root={},o.longitudeObj=t,g.longitudeObj_root=t,o.longitude=o.longitudeObj.longitude,o.geolocation=[o.latitudeObj,o.longitudeObj];{var n=Math.abs(o.latitudeObj.lat_max-o.latitudeObj.lat_min),i=Math.abs(o.longitudeObj.long_max-o.longitudeObj.long_min);(o.latitudeObj.lat_max+o.latitudeObj.lat_min)/2,(o.longitudeObj.long_max+o.longitudeObj.long_min)/2}if(n>i)var u=n;else var u=i;o.zoom=r.location.split("*").length>1?h.runRange(u):6,o.counter=e;for(var _=0;2>_;_++){l.runPlaylist(o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.latitudeObj.lat_min,o.latitudeObj.lat_max,o.longitudeObj.long_min,o.longitudeObj.long_max,g.genres,g.era,o.start_number).then(function(t){if(c=c.concat(t),v.push(_),v.length==_)if(0==t.songsArr.length&&o.holder_arr.length>0){g.loading=!1,o.btnCount>0?(o.noMoreSongs=!0,o.moreHider=!0):(o.noMoreSongs=!1,o.moreHider=!1),o.donesy=!0;{o.holder_arr.length-20,o.holder_arr.length}h.createPlaylist(o.holder_arr).then(function(t){o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){d.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0})}else c.length<100&&o.counter<=5?(o.counter=o.counter+1,1==g.marked?(o.moreHider=!0,o.loading=!1,o.noMoreSongs=!0):o.counter<=5&&t.songsArr.length>0?(o.counter>3&&(o.stillLooking=!0),o.start_number=o.start_number+50,d.count=0,o.runApp(o.start_number,o.counter,"",c,o.holder_arr)):0==c.length?g.noSongs=!0:c.length<=50&&(o.counter>=6||0==t.songsArr.length)?h.checkSongMarket(c).then(function(t){for(var e=[],n=0;n<t.length;n++)e.push(n),f.push(t[n]),e.length==t.length&&(o.holder_songs={},o.holder_arr=f,g.holder_arr_root=o.holder_arr,o.holder_arr.length<=20&&(o.moreHider=!0),h.createPlaylist(f).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){d.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))}):c.length>50&&c.length<100&&o.counter>=6&&p.createChunks(c,50).then(function(t){for(var e=[],n=[],r=0;r<t.length;r++)e.push(r),h.checkSongMarket(t[r].songs).then(function(r){for(var a=0;a<r.length;a++)n.push(a),f.push(r[a]),e.length==t.length&&n.length==r.length&&(o.holder_songs={},o.holder_arr=f,g.holder_arr_root=o.holder_arr,h.createPlaylist(f).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){d.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0})):c.length>50&&(0==o.donesy||void 0==o.donesy)?p.createChunks(c,50).then(function(t){for(var e=[],n=[],r=0;r<t.length;r++)e.push(r),h.checkSongMarket(t[r].songs).then(function(r){for(var a=0;a<r.length;a++)n.push(a),f.push(r[a]),e.length==t.length&&n.length==r.length&&(o.holder_songs={},o.holder_arr=f,rootScope.holder_arr_root=f,r.length%20>0&&o.counter<2&&o.holder_arr.length<150?(o.counter++,d.count=0,o.runApp(o.start_number,o.counter,"",[],o.holder_arr)):h.createPlaylist(f).then(function(t){o.holder_songs.songs=t.songs,o.songs=t.songs.slice(o.index1,o.index2+20),o.songs.spot_arr=t.spot_arr.slice(o.index1,o.index2+20),o.songs.savSpotArr=t.savSpotArr.slice(o.index1,o.index2+20),artistlocation=t.artistlocation.slice(o.index1,o.index2+20),o.songs.location_arr=t.location_arr.slice(o.index1,o.index2+20),o.songs.holder_arr=o.holder_arr,o.songs.spot_strFinal=s.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+o.songs.spot_arr.toString()),g.songs_root=o.songs,h.createLatLng(o.songs.location_arr,o.counter,o.zoom,o.latitudeObj.latitude,o.longitudeObj.longitude,o.final_loc_arr,o.songs.spot_arr).then(function(t){d.count=1,g.mapdata=t,o.stillLooking=!1,g.loading=!1,g.mapOpening=!1,o.checkForMore=!0})},function(){o.errorMessage=!0}))})},function(){o.errorMessage=!0}):0==c.length&&(g.noSongs=!0,a.path("#/map"))},function(){o.errorMessage=!0})}},function(){o.errorMessage=!0})},function(){o.errorMessage=!0})},o.goBack=function(){a.path("playlist/"+o.location.replace(", ","*")),n.changeSymbol()},(1==g.mapOpening||1e11==d.count)&&o.runApp(0,1),o.eventBandData=!1,g.loading=!0,u.getArtistEvents(o.artist).then(function(t){if(void 0==t.data.events.event)o.noEvents=!0;else{o.shows=void 0==t.data.events.event.length?[t.data.events.event]:t.data.events.event,o.noEvents=!1,o.shows.performers=[];for(var e=0;e<o.shows.length;e++)"string"==typeof o.shows[e].artists.artist&&(o.shows[e].artists.artist=[o.shows[e].artists.artist]),o.date=new Date(o.shows[e].startDate),o.hours=o.date.getHours(),o.fin_hours=o.date.getHours()+2,o.month=o.date.getMonth()+1,void 0!=o.shows[e].tags&&void 0!=o.shows[e].tags.tag&&(o.shows[e].tagsStr=o.shows[e].tags.tag.toString().replace(","," ")),o.hours.toString().length<2&&(o.hours="0"+o.hours),o.fin_hours.toString().length<2&&(o.fin_hours="0"+o.fin_hours),o.month.toString().length<2&&(o.month="0"+o.month),o.shows[e].date=o.date.getFullYear()+""+o.month+o.date.getDate()+"T"+o.hours+"0000/"+o.date.getFullYear()+o.month+o.date.getDate()+"T"+o.fin_hours+"0000"}o.eventBandData=!0,g.loading=!1})}]);var Country=angular.module("Country",[]);Country.controller("addCountry",["$scope","$rootScope","retrieveLocation","LocationDataFetch","$location","$routeParams","$q","runSymbolChange","PlaylistCreate","Wiki","MapCreate","States","$sce","Favorites","ShareSongs","getLocation","Spotify",function(){}]);var SongsAbout=angular.module("SongsAbout",[]);SongsAbout.controller("findSongsAbout",["Spotify","$scope",function(o,t){t.songs=[],o.runFusionTableJSON(38.35,-77,.75).then(function(o){t.data=o})}]);var LinerNotesControllers=angular.module("LinerNotesControllers",[]);LinerNotesControllers.controller("WriteLinerNotes",["$scope","$http",function(){alert("liner notes")}]);var LinerNotesControllers=angular.module("LinerNotesControllers",[]);LinerNotesControllers.controller("WriteLinerNotes",["$scope","$http",function(){alert("liner notes")}]);