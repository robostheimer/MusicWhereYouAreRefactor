MusicWhereYouAreApp.factory("getLocation",["$q","$http","$sce","PlaylistCreate","HashCreate","$rootScope","$location",function(e,t,a,r,o,n,i){{var s=41.5,l=-91.6;e.defer()}n.genres="",n.tags=[],n.noGeo=!0,n.lookUpSongs=[],n.era="";var c={_checkGeoLocation:function(){navigator.geolocation.getCurrentPosition(c.handle_geolocation_query,c.handle_errors)},handle_geolocation_query:function(e){n.noGeo=!1,s=e.coords.latitude,l=e.coords.longitude;o.runHash(s,l,!0,.05).then(function(e){i.path(e)})},handle_errors:function(e){switch(n.noGeo=!0,e.code){case e.PERMISSION_DENIED:e="Choose a City and State from the form below or enable geolocation on your device.";break;case e.POSITION_UNAVAILABLE:e="We could not detect current position",alert(e);break;case e.TIMEOUT:e="There was a server timeout.",alert(e);break;default:e="There was an unknown error.",alert(e)}}};return{checkGeoLocation:c._checkGeoLocation}}]),MusicWhereYouAreApp.factory("PlaylistCreate",["$q","$rootScope","$http","$sce","MapCreate","HashCreate","$location","$routeParams","States",function(e,t,a,r,o,n,i,s,l){return{runPlaylist:function(e,r,o,n,i,c,u,p,d,h){for(var g=[],f=[],m=[],v=p.split("**"),y=(d.split("**"),""),_=0;_<v.length;_++)v.length>0&&""!=v[_]&&(y+="holiday"!=v[_]?"&style="+v[_]:"&song_type=christmas");if(songs={},""==y&&""==d)var b="http://developer.echonest.com/api/v4/song/search?api_key=3KFREGLKBDFLWSIEC&format=jsonp&results=50&min_latitude="+n+"&max_latitude="+i+"&min_longitude="+c+"&max_longitude="+u+"&bucket=artist_location&bucket=id:spotify-WW&bucket=tracks&limit=true&&song_type=studio&rank_type=familiarity&song_min_hotttnesss=.3&start="+h+"&callback=JSON_CALLBACK";else var b="http://developer.echonest.com/api/v4/song/search?api_key=3KFREGLKBDFLWSIEC&format=jsonp&results=50&min_latitude="+n+"&max_latitude="+i+"&min_longitude="+c+"&max_longitude="+u+"&bucket=artist_location&bucket=id:spotify-WW&bucket=tracks&limit=true&&song_type=studio&rank_type=familiarity&song_min_hotttnesss=.2&start="+h+y+d+"&callback=JSON_CALLBACK";return a.jsonp(b).then(function(e){var t=e.data.response.songs;t=removeDuplicatesArrObj(t,"title",!0),t.songsArr=[],t.songsArr.spot_arr=[],t.songsArr.spot_playlist=[],t.songsArr.location_arr=[],t.songsArr.final_loc_arr=[],t.songsArr.lat_min=n,t.songsArr.long_min=c,t.songsArr.spot_str="";var a="",r=s.location;if(null!=localStorage.leaveOutArr)var o=jQuery.parseJSON(localStorage.leaveOutArr);else var o=[];var i=l.createStateObj();if(1==r.split("*").length)if(2==r.length)for(var u=0;u<i.length;u++)r.toLowerCase()==i[u].abbreviation.toLowerCase()&&(location_rp1=i[u].name,location_rp2=i[u].abbreviation);else for(var u=0;u<i.length;u++)r.replace(/_/g," ").toUpperCase()==i[u].name?(location_rp1=i[u].name,location_rp2=i[u].abbreviation):location_rp1=r;else{var p=r.split("*")[1];if(2==p.length)for(var u=0;u<i.length;u++)p==i[u].abbreviation&&(location_rp1=i[u].name,location_rp2=i[u].abbreviation);else for(var u=0;u<i.length;u++)p.toUpperCase()==i[u].name&&(location_rp1=i[u].name,location_rp2=i[u].abbreviation)}return forEach(t,function(e){var o=t.indexOf(e),n=e.title;1==r.split("*").length?a.toLowerCase().replace(/\W/g," ").match(n.toLowerCase().replace(/\W/g," "))||f.toString().replace(/\W/g,"").match(e.id.replace(/\W/g,""))||g.toString().toLowerCase().replace(/\W/g,"").match(e.title.toLowerCase().replace(/\W/g,""))||(e.artist_location.location.replace(/\W/g,"").toUpperCase().match(location_rp1.replace(/\W/g,"").toUpperCase())||e.artist_location.location.replace(/\W/g,"").toUpperCase().match(location_rp2.replace(/\W/g,"").toUpperCase())||0!=e.tracks.length)&&((null==e.title||null==e.artist_location||null==e.artist_location.location||null==e.id)&&(o+=1),e.favorite=m.toString().replace(/\W/g,"").match(e.id)?"on":"off",e.closeButton=!1,e.num_id=o,e.id=o,t.songsArr.push(e),t.songsArr.spot_arr.push("spotify:track:"+e.id),t.songsArr.spot_playlist.push(e.id),t.songsArr.spot_str+=e.id+",",a+=n):(a.toLowerCase().replace(/\W/g," ").match(n.toLowerCase().replace(/\W/g," "))||f.toString().replace(/\W/g,"").match(e.id.replace(/\W/g,""))||g.toString().toLowerCase().replace(/\W/g,"").match(e.title.toLowerCase().replace(/\W/g,"")))&&0==e.tracks.length||((null==e.title||null==e.artist_location||null==e.artist_location.location||null==e.id)&&(o+=1),e.favorite=m.toString().replace(/\W/g,"").match(e.id)?"on":"off",e.closeButton=!1,e.num_id=o,e.id=o,t.songsArr.push(e),t.songsArr.spot_arr.push("spotify:track:"+e.id),t.songsArr.spot_playlist.push(e.id),t.songsArr.spot_str+=e.id+",",a+=n)}),t=compareArraysObj(t,o,"title")},function(){t.errorMessage=!0})}}}]),MusicWhereYouAreApp.factory("MapCreate",["$q","$http","$sce","$rootScope",function(e,t,a,r){return r.latitude=0,r.longitude=150,r.locationarrstr="",r.zoom,r.mapOpening=!0,{runMap:function(e,t,a,o){r.latitude=t,r.longitude=a,r.locationarrstr=o.toString(),r.zoom=e,r.mapOpening=!1}}}]),MusicWhereYouAreApp.factory("LocationDataFetch",["retrieveLocation",function(){var e={};return e.count=0,e}]),MusicWhereYouAreApp.factory("retrieveLocation",["$q","$rootScope","$http","$sce","$window","$location","States",function(e,t,a,r,o,n,i){return{runLocation:function(e,r,o){var n,e=e.replace("*",", "),s=Number(),l=Number(),c={},u=i.createStateObj();if(e.split(" ").length>1&&e.match(",")){if(e.split(",")[1].replace(" ","").length>2)var p=e.split(","),d=toTitleCase(p[0]),h=toTitleCase(p[1].replace(" ",""));else{e=e.replace("_"," ");for(var g=e.split(", ")[1].split(" ")[0].toUpperCase(),f=0;f<u.length;f++)if(u[f].abbreviation==g)var m=u[f].name,p=e.split(", "),d=toTitleCase(p[0]),h=m}var v="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Lat,Region,CityName,CountryID+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+Region=%27"+h.toUpperCase()+"%27+AND+CityName=%27"+d.toUpperCase()+"%27+ORDER%20BY+Lat&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0&callback=JSON_CALLBACK",y="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Long,Region,CityName,CountryID,Lat+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+Region=%27"+h.toUpperCase()+"%27+AND+CityName=%27"+d.toUpperCase()+"%27+ORDER%20BY+Long&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0&callback=JSON_CALLBACK";return"lat"==r?a.jsonp(v).then(function(a){if(null!=a.data.rows){forEach(a.data.rows,function(e){s+=parseFloat(e[0])}),c.latitude=s/a.data.rows.length;{var r=distance_to_degrees_lat(7*o);distance_to_degrees_lon(n,7*o)}c.lat_min=a.data.rows[0][0]-r,c.lat_max=a.data.rows[a.data.rows.length-1][0]+r,c.location=e,c.country=a.data.rows[0][3],null==localStorage.country&&(localStorage.country=c.country)}else t.noSongs=!0;return c}):a.jsonp(y).then(function(a){if(null!=a.data.rows){forEach(a.data.rows,function(e){l+=parseFloat(e[0]),s+=parseFloat(e[4])}),c.longitude=l/a.data.rows.length;var r=s/a.data.rows.length,n=(distance_to_degrees_lat(7*o),distance_to_degrees_lon(r,7*o));c.long_min=a.data.rows[0][0]-n,c.long_max=a.data.rows[a.data.rows.length-1][0]+n,c.location=e,c.country=a.data.rows[0][3]}else t.noSongs=!0;return c})}if(2==e.length){for(var g=e.toUpperCase(),f=0;f<u.length;f++)if(u[f].abbreviation==g)var e=u[f].name.toLowerCase()}else var e=e;var v="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Lat,Region,CityName,CountryID+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+Region=%27"+e.toUpperCase()+"%27+ORDER%20BY+Lat&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0&callback=JSON_CALLBACK",y="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Long,Region,CityName,CountryID,Lat+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+Region=%27"+e.toUpperCase()+"%27+ORDER%20BY+Long&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0&callback=JSON_CALLBACK";return e=toTitleCase(e),"lat"==r?a.jsonp(v).then(function(a){if(null!=a.data.rows){forEach(a.data.rows,function(e){s+=parseFloat(e[0])}),c.latitude=s/a.data.rows.length;{var r=distance_to_degrees_lat(7*o);distance_to_degrees_lon(n,7*o)}c.lat_min=a.data.rows[0][0]-r,c.lat_max=a.data.rows[a.data.rows.length-1][0]+r,c.location=e,c.country=a.data.rows[0][3],null==localStorage.country&&(localStorage.country=c.country)}else t.noSongs=!0;return c}):a.jsonp(y).then(function(a){if(null!=a.data.rows){c.longitude=a.data.rows[0][0],forEach(a.data.rows,function(e){l+=parseFloat(e[0]),s+=parseFloat(e[4])}),c.longitude=l/a.data.rows.length;var r=s/a.data.rows.length,n=(distance_to_degrees_lat(7*o),distance_to_degrees_lon(r,7*o));c.long_min=a.data.rows[0][0]-n,c.long_max=a.data.rows[a.data.rows.length-1][0]+n,c.location=e,c.country=a.data.rows[0][3]}else t.noSongs=!0;return c})}}}]),MusicWhereYouAreApp.factory("HashCreate",["$q","$rootScope","$http","$sce","$location","$routeParams",function(e,t,a,r,o){return{runHash:function(e,t,r,n){var i="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+CityName%2C+Region%2C+CountryID+FROM+1B8NpmfiAc414JhWeVZcSqiz4coLc_OeIh7umUDGs+WHERE+Lat+<="+(e+n)+"+AND+Lat>="+(e-n)+"+AND+Long<="+(t+n)+"+AND+Long>="+(t-n)+"&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0";return a.get(i).then(function(e){if(null!=e.data.rows){var t=e.data.rows[0][0],a=e.data.rows[0][1],n=e.data.rows[0][2];null==localStorage.country&&(localStorage.country=n);var i={city:t,state:a};t.split(" ")>1&&(t=t.replace(/ /g,"_")),a.split(" ")>1&&(a=a.replace(/ /g,"_"));var s=o.path().split("/")[1].split("/")[0],l=t+"*"+a+"/";return 1==r?s+"/"+l.replace(/ /g,"_"):i}})}}}]),MusicWhereYouAreApp.factory("loadGenreCheckData",["$routeParams","$http",function(e,t){return{getGenre:function(){var e=[{genre:{checked:!1,isSelected:!1,state:"off",genre:"avant garde",similarGenres:"avant garde**avant garde jazz**avant garde metal",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"blues",similarGenres:"blues**blues guitar**blues revival**blues rock**blues-rock**british blues**chicago blues**classic blues**contemporary blues**country blues**delta blues**electric blues**juke joint blues louisiana blues**memphis blues**modern blues**modern electric blues**new orleans blues**slide guitar blues**soul blues**texas blues",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"classic rock",similarGenres:"classic rock",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"classical",similarGenres:"classical**classical pop**contemporary classical music**crossover classical**modern classical",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"comedy",similarGenres:"comedy**comedy rock",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"country",similarGenres:"country rock**alternative country**country**honky tonk**cowboy punk**classic country**modern country**hillbilly**rockabilly**bluegrass**country pop**outlaw country**pop country**progressive country**texas country",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"drama",similarGenres:"drama",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"electronic",similarGenres:"electronic**electro**electro hip hop**electro house**electro rock**electro-funk**electro-industrial**electro jazz**experimental electronic**indie electronic",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"folk",similarGenres:"folk**acid folk**alternative folk**contemporary folk**country folk**electric folk**folk pop**folk revival**folk rock**folk pop**indie folk**neo folk**pop folk**psychedelic folk**stomp and holler**traditional folk**urban folk",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"hip hop",similarGenres:"hip hop**classic hip hop**rap**west coast hip hop**alternative hip hop**east coast hip hop**electro hip hop**experimental hip hop**independent hip hop**indie hip hop**jazz hip hop**old school hip hop**southern hip hop",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"holiday",similarGenres:"holiday",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"indie",similarGenres:"indie rock**geek rock**lo fi**math rock**indie folk**indie hip hop**indie**indy",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"jazz",similarGenres:"jazz**jazz blues**jazz funk**jazz fusion**jazz hip hop**jazz rock**jazz vocal**latin jazz**modern jazz**new orleans jazz**soul jazz**traditional jazz",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"kid music",similarGenres:"children's music",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"latin",similarGenres:"latin**latin jazz**jazz latino**latin alternative**latin folk**latin hip hop**latin pop**latin music**latin rap**latin rock**latin ska",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"new age",similarGenres:"new age**new age music",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"motown",similarGenres:"motown**classic motown**soul**memphis soul**old school soul**soul music**soul",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"pop",similarGenres:"pop 60s pop**80s pop**acoustic pop**alternative pop**pop rock**dance pop**folk pop**jangle pop**pop country**pop punk**pop rap**pop folk**psychedelic pop",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"punk",similarGenres:"punk**punk rock**acoustic punk**art punk**anarcho punk**classic punk**cowpunk**dance-punk**cyberpunk**emo punk**folk punk**garage punk**hardcore punk**indie punk**old school punk**political punk**skate punk**street punk",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"rock",similarGenres:"rock**punk rock**classic rock**college rock**dance rock**electro rock**folk rock**garage rock**jam band**hard rock**modern rock**psychedelic stoner rock**punk**southern rock**80s rock**90s rock**70s rock**60s rock**alternative rock**acoustic rock**acid rock",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"soft rock",similarGenres:"soft rock**easy listening",year_end:""}},{genre:{checked:!1,isSelected:!1,state:"off",genre:"world",similarGenres:"world world music**world beat**world fusion",year_end:""}}];return e},getEra:function(){var e=new Date,t=[{era:{checked:!1,isSelected:!1,state:"off",era:"twentyten",year_begin:"2010",year_end:e.getFullYear()}},{era:{checked:!1,isSelected:!1,state:"off",era:"twenty",year_begin:"2000",year_end:"2009"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteenninty",year_begin:"1990",year_end:"1999"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteeneighty",year_begin:"1980",year_end:"1989"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteenseventy",year_begin:"1970",year_end:"1979"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteensixty",year_begin:"1960",year_end:"1969"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteenfifty",year_begin:"1950",year_end:"1959"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteenforty",year_begin:"1940",year_end:"1949"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteenthrity",year_begin:"1930",year_end:"1939"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteentwenty",year_begin:"1920",year_end:"1929"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteenten",year_begin:"1910",year_end:"1919"}},{era:{checked:!1,isSelected:!1,state:"off",era:"nineteen",year_begin:"1900",year_end:"1909"}},{era:{checked:!1,isSelected:!1,state:"off",era:"eighteenninty",year_begin:"1890",year_end:"1899"}},{era:{checked:!1,isSelected:!1,state:"off",era:"eighteeneighty",year_begin:"1880",year_end:"1889"}},{era:{checked:!1,isSelected:!1,state:"off",era:"eighteenseventy",year_begin:"1870",year_end:""}},{era:{checked:!1,isSelected:!1,state:"off",era:"eighteensixty",year_begin:"1860",year_end:"1869"}}];return t},getMood:function(){return Mode},loadEchonestStyles:function(){var e="json/echonest_genres.json";return t.get(e).then(function(e){var t=e.data.response.terms;return t})}}}]),MusicWhereYouAreApp.factory("runSymbolChange",["$rootScope","$location",function(e,t){return{addButtons:function(){var t={},a={},r={},o={},n={},i={};return t.name="genre",t.classy="iconequalizer12",t.state="off",a.name="playlist",a.classy="icon-song",a.state="off",r.name="favorite",r.classy="iconfavorite",r.state="off",o.name="map",o.classy="iconmap",o.state="off",n.name="jukebox",n.classy="jukebox",n.state="off",i.name="roadsoda",i.classy="roadsoda",i.state="off",icons=[t,a,r,o,n],e.icons=icons,icons},changeSymbol:function(){void 0!=e.icons&&forEach(e.icons,function(e){e.state="off",t.path().match(e.name)&&(e.state="on")})}}}]),MusicWhereYouAreApp.factory("retrieveInfo",["$q","$rootScope","$http","$sce","$location",function(e,t,a,r,o){return{infoRetrieve:function(e){var t={},o=e.replace(/\*/g," "),n="http://developer.echonest.com/api/v4/artist/search?api_key=3KFREGLKBDFLWSIEC&format=jsonp&name="+o+"&results=1&bucket=songs&bucket=biographies&bucket=images&bucket=id:spotify-WW&limit=true&bucket=video&bucket=news&bucket=artist_location&rank_type=familiarity&callback=JSON_CALLBACK";return a.jsonp(n).then(function(e){if(t=e.data.response.artists[0],t.spot_url=[],t.bio={},t.bio.text="",t.ytArr=[],t.videoArr=[],t.lastfm_imgs=[],forEach(t.video,function(e){e.url.match("youtube")&&t.ytArr.push(e.url)}),forEach(t.news,function(e){e.news_summary=removeHTML(e.summary)}),t.ytArr.length<7)var a=t.ytArr.length;else var a=7;forEach(a,function(){t.videoArr.push(r.trustAsResourceUrl("http://www.youtube.com/embed/"+t.ytArr[g].slice(t.ytArr[g].indexOf("?v="),t.ytArr[g].indexOf("&feature")).replace("?v=","")))});for(var o=0;o<t.biographies.length;o++)t.biographies[o].site.match("last.fm")&&(t.bio=e.data.response.artists[0].biographies[o],t.bio.text.length>2700?(t.bio.text=textSlicer(t.bio.text,2700)+"... ",t.bio_site="Read More at "+t.bio.site):t.bio_site="Courtesy of "+t.bio.site);""==t.bio.text&&(t.bio.text="No published biography exists for this band.");for(var n=0;n<t.images.length;n++)if(t.images[n].url.match("last.fm")&&t.images[n].url.match("serve")){var i=t.images[n].url.split("serve/")[1];i=i.slice(t.images[n].url.split("serve/")[1].indexOf("/"),t.images[n].url.split("serve/")[1].length),t.images[n].src="http://userserve-ak.last.fm/serve/126s"+i,t.lastfm_imgs.push(t.images[n])}if(0==t.images.length)for(var s=0;5>s;s++)t.images.push("logo4_sm.png");return t})},imagesRetrieve:function(e){var t={},r="php/wikimedia.php?q="+e.replace(/\*/g," ")+"music";return a.get(r).success(function(e){return t=e.data})},lookUpArtist:function(e){var t='https://api.spotify.com/v1/search?q="'+e+'"&type=artist&limit=1';return a.get(t).success(function(e){var t=e.artists.items[0].id;return t})},spotifyRetrieve:function(e){return a.get("https://api.spotify.com/v1/artists/"+e+"/top-tracks?country=US").success(function(e){return artistsongs=e,artistsongs.spot_url=[],artistsongs.spot_url_button=[],forEach(artistsongs.tracks,function(e){artistsongs.spot_url.push(e.id),artistsongs.spot_url_button.push(e.id)}),artistsongs.spot_url_str=r.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+artistsongs.spot_url.toString()),artistsongs})},relatedRetrieve:function(e){relatedartists={};var t="http://developer.echonest.com/api/v4/artist/similar?api_key=3KFREGLKBDFLWSIEC&format=json&name="+e+"&results=10&&bucket=id:spotify-WW&bucket=images&bucket=artist_location";return a.get(t).success(function(e){return relatedartists=e.response.artists,relatedartists.relatedartistsfinal=[],forEach(relatedartists,function(e){null!=e.artist_location&&relatedartists.relatedartistsfinal.push(e)}),forEach(relatedartists.relatedartistsfinal,function(e){e.href="#/info/"+o.path().split("/")[2]+"/"+e.name.replace("The ",""),e.lastfm_imgs=[],forEach(e.images,function(t){if(t.url.match("last.fm")&&t.url.match("serve")){var a=t.url.split("serve/")[1];a=a.slice(t.url.split("serve/")[1].indexOf("/"),t.url.split("serve/")[1].length),t.src="http://userserve-ak.last.fm/serve/126s"+a,e.lastfm_imgs.push(t)}}),0==e.lastfm_imgs.length&&e.lastfm_imgs.push({src:"/MusicWhereYouAre/logo4_sm.png"})}),relatedartists})},createObjects:function(){var e={};return e.bio={},e.photos={},e.videos={},e.topsongs={},e.news={},e.related={},e.bio.name="bio",e.bio.classy="shower",e.bio.state="on",e.photos.name="photos",e.photos.classy="hider",e.photos.state="off",e.videos.name="videos",e.videos.classy="hider",e.videos.state="off",e.topsongs.name="top songs",e.topsongs.classy="hider",e.topsongs.state="off",e.news.name="news",e.news.classy="hider",e.news.state="off",e.related.name="Related Artists",e.related.classy="hider",e.related.state="off",e}}}]),MusicWhereYouAreApp.factory("Favorites",["$http","$routeParams","$location","$rootScope","$sce",function(){return{addFavorites:function(){if(null!=localStorage.getItem("FavoriteArr")&&""!=localStorage.getItem("FavoriteArr"))var e=jQuery.parseJSON(localStorage.getItem("FavoriteArr"));else e=[];forEach(e,function(t){t.num_id=e.indexOf(t)}),localStorage.setItem("FavoriteArr",JSON.stringify(e))},checkFavorites:function(e){if(null!=localStorage.getItem("FavoriteArr")&&""!=localStorage.getItem("FavoriteArr"))var t=jQuery.parseJSON(localStorage.getItem("FavoriteArr"));else t=[];forEach(t,function(t){t.favorite="off",t.id==e.id&&(e.favorite="on")})}}}]),MusicWhereYouAreApp.factory("States",["$http","$routeParams","$location","$rootScope","$sce",function(e){return{createStateObj:function(){var e=[{name:"ALABAMA",abbreviation:"AL",num:0,isThere:!1},{name:"ALASKA",abbreviation:"AK",num:0,isThere:!1},{name:"ARKANSAS",abbreviation:"AR",num:0,isThere:!1},{name:"AMERICAN SAMOA",abbreviation:"AS",num:0,isThere:!1},{name:"ARIZONA",abbreviation:"AZ",num:0,isThere:!1},{name:"CALIFORNIA",abbreviation:"CA",num:0,isThere:!1},{name:"COLORADO",abbreviation:"CO",num:0,isThere:!1},{name:"CONNECTICUT",abbreviation:"CT",num:0,isThere:!1},{name:"DISTRICT OF COLUMBIA",abbreviation:"DC",num:0,isThere:!1},{name:"DELAWARE",abbreviation:"DE",num:0,isThere:!1},{name:"FLORIDA",abbreviation:"FL",num:0,isThere:!1},{name:"GEORGIA",abbreviation:"GA",num:0,isThere:!1},{name:"GUAM",abbreviation:"GU",num:0,isThere:!1},{name:"HAWAII",abbreviation:"HI",num:0,isThere:!1},{name:"IOWA",abbreviation:"IA",num:0,isThere:!1},{name:"IDAHO",abbreviation:"ID",num:0,isThere:!1},{name:"ILLINOIS",abbreviation:"IL",num:0,isThere:!1},{name:"INDIANA",abbreviation:"IN",num:0,isThere:!1},{name:"KANSAS",abbreviation:"KS",num:0,isThere:!1},{name:"KENTUCKY",abbreviation:"KY",num:0,isThere:!1},{name:"LOUISIANA",abbreviation:"LA",num:0,isThere:!1},{name:"MASSACHUSETTS",abbreviation:"MA",num:0,isThere:!1},{name:"MARYLAND",abbreviation:"MD",num:0,isThere:!1},{name:"MAINE",abbreviation:"ME",num:0,isThere:!1},{name:"MICHIGAN",abbreviation:"MI",num:0,isThere:!1},{name:"MINNESOTA",abbreviation:"MN",num:0,isThere:!1},{name:"MISSOURI",abbreviation:"MO",num:0,isThere:!1},{name:"MISSISSIPPI",abbreviation:"MS",num:0,isThere:!1},{name:"MONTANA",abbreviation:"MT",num:0,isThere:!1},{name:"NORTH CAROLINA",abbreviation:"NC",num:0,isThere:!1},{name:"NORTH DAKOTA",abbreviation:"ND",num:0,isThere:!1},{name:"NEBRASKA",abbreviation:"NE",num:0,isThere:!1},{name:"NEW HAMPSHIRE",abbreviation:"NH",num:0,isThere:!1},{name:"NEW JERSEY",abbreviation:"NJ",num:0,isThere:!1},{name:"NEW MEXICO",abbreviation:"NM",num:0,isThere:!1},{name:"NEVADA",abbreviation:"NV",num:0,isThere:!1},{name:"NEW YORK",abbreviation:"NY",num:0,isThere:!1},{name:"OHIO",abbreviation:"OH",num:0,isThere:!1},{name:"OKLAHOMA",abbreviation:"OK",num:0,isThere:!1},{name:"OREGON",abbreviation:"OR",num:0,isThere:!1},{name:"PENNSYLVANIA",abbreviation:"PA",num:0,isThere:!1},{name:"PUERTO RICO",abbreviation:"PR",num:0,isThere:!1},{name:"RHODE ISLAND",abbreviation:"RI",num:0,isThere:!1},{name:"SOUTH CAROLINA",abbreviation:"SC",num:0,isThere:!1},{name:"SOUTH DAKOTA",abbreviation:"SD",num:0,isThere:!1},{name:"TENNESSEE",abbreviation:"TN",num:0,isThere:!1},{name:"TEXAS",abbreviation:"TX",num:0,isThere:!1},{name:"UTAH",abbreviation:"UT",num:0,isThere:!1},{name:"VIRGINIA",abbreviation:"VA",num:0,isThere:!1},{name:"VIRGIN ISLANDS",abbreviation:"VI",num:0,isThere:!1},{name:"VERMONT",abbreviation:"VT",num:0,isThere:!1},{name:"WASHINGTON",abbreviation:"WA",num:0,isThere:!1},{name:"WISCONSIN",abbreviation:"WI",num:0,isThere:!1},{name:"WEST VIRGINIA",abbreviation:"WV",num:0,isThere:!1},{name:"WYOMING",abbreviation:"WY",num:0,isThere:!1},{name:"BREMUDA",abbreviation:"BM",num:0,isThere:!1}];return e},createCountriesObj:function(){return e.get("json/countries.json").then(function(e){return e})}}}]),MusicWhereYouAreApp.factory("HintShower",["$q","$rootScope","$http","$sce","$location","States",function(e,t,a,r,o,n){e.defer();return{showHint:function(e){var t=n.createStateObj(),r={};if(3==e.length){var o=e[1];return e[1].length<3&&forEach(t,function(){e[1].toUpperCase().match(t.abbreviation)}),a.get("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Region,CityName,CountryID+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+Region=%27"+o+"%27+AND+CityName=%27"+e[0]+"%27+AND+CountryID%=%27"+e[2]+"%27+ORDER%20BY+CityName&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0").then(function(e){r=e.data.rows,void 0!=e.data.rows&&(r.finalArr=[],forEach(e.data.rows,function(e){r.stateArr.push(e[0]),r.finalArr.push({city:e[1],cityhref:e[1].replace(/ /g,"_"),state:e[0],statehref:e[0].replace(/ /g,"_"),country:e[2],countryhref:e[2].replace(/ /g,"_")})}))})}if(2==e.length){var o=e[1];return e[1].length<3&&forEach(result.data.rows,function(e){r.stateArr.push(e[0]),r.finalArr.push({city:e[1],cityhref:e[1].replace(/ /g,"_"),state:e[0],statehref:e[0].replace(/ /g,"_"),country:e[2],countryhref:e[2].replace(/ /g,"_")})}),a.get("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Region,CityName,CountryID+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+Region=%27"+o.toUpperCase()+"%27+AND+CityName=%27"+e[0].toUpperCase()+"%27+ORDER%20BY+CityName&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0").then(function(e){return void 0!=e.data.rows&&(r=e.data.rows,r.finalArr=[],null!=e.data.rows.length)?(forEach(e.data.rows,function(e){r.finalArr.push({city:e[1],cityhref:e[1].replace(/ /g,"_"),state:e[0],statehref:e[0].replace(/ /g,"_"),country:e[2],countryhref:e[2].replace(/ /g,"_")})}),r):void 0})}return 1==e.length?a.get("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Region,CityName,CountryID+FROM+1_7XFAaYei_-1QN5dIzQQB8eSam1CL0_0wYpr0W0G+WHERE+CityName=%27"+e[0].toUpperCase()+"%27+ORDER%20BY+CityName&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0").then(function(e){return void 0!=e.data.rows?(r=e.data.rows,r.finalArr=[],forEach(e.data.rows,function(e){r.finalArr.push({city:e[1],cityhref:e[1].replace(/ /g,"_"),state:e[0],statehref:e[0].replace(/ /g,"_"),country:e[2],countryhref:e[2].replace(/ /g,"_")})}),r):void 0}):void 0}}}]),MusicWhereYouAreApp.factory("Events",["$q","$rootScope","$http","$sce","$location","States","$routeParams",function(e,t,a){return{getGeoEvents:function(e,t){return a.get("http://ws.audioscrobbler.com/2.0/?method=geo.getevents&lat="+e+"&long="+t+"&api_key=174019d04974adad421f3fb19681277e&limit=50&format=json&distance=41.5").then(function(e){return e})},getArtistEvents:function(e){return a.get("http://ws.audioscrobbler.com/2.0/?method=artist.getevents&artist="+e+"&api_key=174019d04974adad421f3fb19681277e&limit=25&format=json").then(function(e){return e})}}}]),MusicWhereYouAreApp.factory("ShareSongs",["$q","$rootScope","$http","$sce","$location","States","$routeParams","retrieveLocation",function(e,t,a,r,o,n,i){return{getSongs:function(t,a){var r=e.defer(),o="";forEach(t,function(e){o+=e.name.replace(/&/g,"and").replace("?","q*m")+"{"+e.id+"~"+e.artists[0].name.replace(/&/g,"and")+"}"+e.favorite+"]"+e.artist_location.latitude+","+e.artist_location.longitude+"**"});var n=a.replace(/ /g,"_")+"/"+o.replace(/%20/g,"_").replace(/\//g,"--");return n="/playlist/"+n.replace(/ /g,"_").replace(/%20/g,"_").replace(/\//g,"--"),r.resolve(n),r.promise},createSongsList:function(){var t=e.defer(),a=i.qs,n=[],s="",l=a.split("**"),c=[],u=[],p=[],d=[],h=[],g=[];n.spot_arr=[],n.savSpotArr=[],n.songsArr=[],n.spot_str="",n.location_arr=[],n.final_loc_arr=[],n.spot_arr=[],n.song_arr=[],l.pop();for(var f=0;f<l.length;f++)u.push(l[f].split("{")[0].replace(/_/g," ").replace("q*m","?")),c.push(l[f].split("{")[1].split("~")[0]),g.push(l[f].split("~")[1].split("}")[0].replace(/_/g," ")),p.push(l[f].split("}")[1].split("]")[0]),d.push(parseFloat(l[f].split("]")[1].split(",")[0])),h.push(parseFloat(l[f].split("]")[1].split(",")[1])),n.push({name:u[f],tracks:{foreign_id:{spotify:{track:c[f]}}},favorite:p[f],artists:{0:{name:g[f]}},artist_location:{latitude:d[f],longitude:h[f],location:o.path().split("/")[2].split("/")[0].replace("*",", ").replace(/_/g," ")}}),n.location_arr.push(o.path().split("/")[2].split("/")[0].replace("*",", ")+"@@"+d[f]+":"+h[f]+"&&<h5>"+u[f]+"</h5><p>"+g[f]+'</p><a href="spotify:track:'+c[f]+'" ><div class="spot_link"  aria-hidden="true" data-icon="c" id="infobox_spot_link"+x></div></a><a><a a href="#/info/'+o.path().split("/")[2].split("/")[0]+"/"+g[f].replace("The ","")+'" ><div style="font-size:20px" class="spot_link information" id="infobox_info"+x  aria-hidden="true" data-icon="*"></div></a><div style="clear:both"></div>'),n.spot_str+=c[f]+",",n.songsArr.push(n[f]),n.song_arr.push(c[f]),n[f].id=c[f],n.savSpotArr.push("spotify:track:"+c[f].id);return n.spot_strFinal=r.trustAsResourceUrl("https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE"+n.spot_str),n.location_arr.sort(),forEach(n.location_arr,function(e){s.match(e.split("@@")[0])?n.final_loc_arr.push(e.split("@@")[1].split("&&")[1]):(n.final_loc_arr.push("%%"+e),s+=e.split("@@")[0])}),t.resolve(n),t.promise},getLongURL:function(t){var a=e.defer();if(t.length>2e3){var t=t.slice(0,2e3),r=t.lastIndexOf("**");t=t.slice(0,r);var o={url:t.replace("--","/"),sliced:"yes"}}else var t=t,o={url:t.replace("--","/"),sliced:"no"};return t=t.replace("--","/"),a.resolve(o),a.promise},getBitLy:function(e){var t="http://api.bitly.com/v3/shorten?format=json&apiKey=R_06ae3d8226a246f2a0bb68afe44c8379&login=robostheimer&longUrl=http://musicwhereyour.com/%23"+encodeURIComponent(e);return a.get(t).then(function(e){return e.data.data.url})}}}]),MusicWhereYouAreApp.factory("Wiki",["$q","$rootScope","$http","$sce","$location","States","$routeParams","Spotify",function(e,t,a){return{getWikiLandmarks:function(e,t,r){var r="-"+r.toLowerCase(),o="http://api.v3.factual.com/t/places"+r+"?filters={%22category_ids%22:{%22$excludes_any%22:[2,347,308,432,123,384,385,405, 62,40, 235,414, 379, 23, 34, 221, 395,272,219,37,51,417,296,44,47,48,193,177,420,53,429, 375,377,378,380,381,382,383, 386,388,390,391,393,394,397,398,399,400,401,402,404,407,408,409,410,277]}}&include_count=true&limit=20&select=name&KEY=1ZlzUGTss1cocs7sHpIA6ypd3PJIsMs9Fwlth1Du&geo=%7B%22$circle%22:%7B%22$center%22:%5B"+e+","+t+"%5D,%22$meters%22:%2025000%7D%7D";return a.get(o).then(function(e){for(var t=0;t<e.data.response.data.length;t++)e.data.response.data[t].number=5;return e.data})},lookUpTag:function(a,r,o,n){t.loading_tags=!0;var i=e.defer(),s=jQuery.parseJSON(localStorage.getItem("leaveOutArr")),l=[],c=[];lsIdFavArr=[],null!=s?forEach(s.length,function(e){l.push(e.song),c.push(e.id)}):(l=[],c=[]);var u=jQuery.parseJSON(localStorage.getItem("FavoriteArr"));null!=u?forEach(u.length,function(e){lsIdFavArr.push(e.id)}):lsIdFavArr=[];var p={arr:l,searchterm:a.replace(/The /g,""),number:r,qs:o,type:n};return i.resolve(p),i.promise}}}]),MusicWhereYouAreApp.factory("Spotify",["$q","$rootScope","$http","$sce","$routeParams","Favorites","MapCreate","HashCreate","ChunkSongs",function(e,t,a,r,o,n){return{runLyricsnMusic:function(e){return a.jsonp('http://api.lyricsnmusic.com/songs?api_key=548b2523656cf7b2bbf49252673c24&lyrics="'+e+'"&callback=JSON_CALLBACK').then(function(e){var t=e.data.data;return t})},runSpotifySearch:function(e,t,r){if(void 0!=localStorage.country&&""!=localStorage.country)if("no"==r)var o="https://api.spotify.com/v1/search?q="+e+"%20AND%20NOT%20Live%20AND%20NOT%20%2250%20Songs%22%20AND%20NOT%20album:%22Live%22%20%20AND%20NOT%20album:%22 "+e+"%22AND%20NOT%20genre:%22Audiobooks%22%20AND%20NOT%20genre:%22Spoken%20Word%22AND%20NOT%20genre:%22oratory%22AND%20NOT%20artist:%22"+e+'%22AND%20NOT%20artist:"The%20Guy%20Who%20Sings%20Songs"AND%20NOT%20artist:"'+e.split(", ")[0]+'"AND%20NOT%20artist:"'+e.split(", ")[1]+'"&type=track&limit='+t+"&ioffset=0&market="+localStorage.country.toUpperCase();
else var o='https://api.spotify.com/v1/search?q="'+e.split(", ")[0]+'"%20AND%20NOT%20Live%20AND%20NOT%20%2250%20Songs%22%20AND%20NOT%20album:%22Live%22%20%20AND%20NOT%20album:%22 '+e.split(", ")[0]+"%22AND%20NOT%20genre:%22Audiobooks%22%20AND%20NOT%20genre:%22Spoken%20Word%22AND%20NOT%20genre:%22oratory%22AND%20NOT%20artist:%22"+e.split(", ")[0]+'%22AND%20NOT%20artist:"The%20Guy%20Who%20Sings%20Songs"AND%20NOT%20artist:"'+e.split(", ")[0]+'"&type=track&limit='+t+"&ioffset=0&market="+localStorage.country.toUpperCase();else if("no"==r)var o="https://api.spotify.com/v1/search?q="+e+"%20AND%20NOT%20Live%20AND%20NOT%20%2250%20Songs%22%20AND%20NOT%20album:%22Live%22%20%20AND%20NOT%20album:%22 "+e+"%22AND%20NOT%20genre:%22Audiobooks%22%20AND%20NOT%20genre:%22Spoken%20Word%22AND%20NOT%20genre:%22oratory%22AND%20NOT%20artist:%22"+e+'%22AND%20NOT%20artist:"The%20Guy%20Who%20Sings%20Songs"AND%20NOT%20artist:"'+e.split(", ")[0]+'"AND%20NOT%20artist:"'+e.split(", ")[1]+'"&type=track&limit='+t+"&ioffset=0";else var o='https://api.spotify.com/v1/search?q="'+e.split(", ")[0]+'"%20AND%20NOT%20Live%20AND%20NOT%20%2250%20Songs%22%20AND%20NOT%20album:%22Live%22%20%20AND%20NOT%20album:%22 '+e.split(", ")[0]+"%22AND%20NOT%20genre:%22Audiobooks%22%20AND%20NOT%20genre:%22Spoken%20Word%22AND%20NOT%20genre:%22oratory%22AND%20NOT%20artist:%22"+e.split(", ")[0]+'%22AND%20NOT%20artist:"The%20Guy%20Who%20Sings%20Songs"AND%20NOT%20artist:"'+e.split(", ")[0]+"&type=track&limit="+t+"&ioffset=0";return a.get(o).then(function(t){var a=t.data.tracks.items;if(null!=localStorage.leaveOutArr)var r=jQuery.parseJSON(localStorage.leaveOutArr);else var r=[];return forEach(a,function(t){t.searchterm=e}),a=compareArraysObj(a,r,"title")})},checkSongMarket:function(e){var t=[],r=[],o="";forEach(e,function(e){t.push(e),o+=e.tracks[0].foreign_id.split(":")[2]+","}),o=o.slice(0,o.length-1);var n="https://api.spotify.com/v1/tracks/?ids="+o;return a.get(n).then(function(e){var a=e.data.tracks;return forEach(a,function(e){var o=a.indexOf(e);void 0!=localStorage.country&&""!=localStorage.country?(e.favorite="off",e.num_id=r.length,e.artist_location=t[o].artist_location,e.available_markets.toString().match(localStorage.country)&&r.push(e)):(e.favorite="off",a=num_id=r.length,a.artist_location=t[o].artist_location,r.push(a))}),r})},createPlaylist:function(t){var a=e.defer(),i={};return i.songs=[],i.spot_arr=[],i.savSpotArr=[],i.artistlocation="",i.spot_str="",i.location_arr=[],forEach(t,function(e){var a=t.indexOf(e);e.artists[0].name=findThe(e.artists[0].name),e.num_id=a,i.songs.push(e),n.checkFavorites(e),i.spot_arr.push(e.id),i.savSpotArr.push("spotify:track:"+e.id),i.artistlocation=o.location,i.tracks=[{foreign_id:e.uri}],i.location_arr.push(e.artist_location.location+"@@"+e.artist_location.latitude+":"+e.artist_location.longitude+"&&<h5>"+e.name+"</h5><p>"+e.artists[0].name+'</p><a href="spotify:track:'+e.id+'" ><div class="spot_link"  aria-hidden="true" data-icon="c" id="infobox_spot_link"+songs.length></div></a><a><a a href="#/info/'+i.artistlocation+"/"+e.artists[0].name.replace("The ","")+'" ><div style="font-size:20px" class="spot_link information" id="infobox_info"+songs.length  aria-hidden="true" data-icon="*"></div></a><div style="clear:both"></div>')}),i.spot_str="https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:"+i.spot_arr.toString(),i.spot_strFinal=r.trustAsResourceUrl(i.spot_str),a.resolve(i),a.promise},createLatLng:function(t,a,r,o,n){t.sort();for(var i=e.defer(),s="",l=[],c=[],u=0;u<t.length;u++)if(c.push(u),s.match(t[u].split("@@")[0])?l.push(t[u].split("@@")[1].split("&&")[1]):(l.push("%%"+t[u]),s+=t[u].split("@@")[0]),u==t.length-1)return i.resolve({zoom:r,latitude:o,longitude:n,locationarrstr:l.toString(),change:Math.random()}),i.promise},lookUpEchonest:function(r){var o=e.defer();if(void 0==r.artist_location||jQuery.isEmptyObject(r.artist_location)){var n=(removeSpecialChar(r.name),removeSpecialChar(r.artists[0].name));return a.get("http://developer.echonest.com/api/v4/song/search?api_key=MIV6XZXYU7FNSMMDN&format=json&results=1&&artist="+n+"&bucket=artist_location").then(function(e){return 0==e.data.response.songs.length?(r.artist_location={latitude:t.latitudeObj_root.latitude,longitude:t.longitudeObj_root.longitude,location:"No Location Data Available",location_link:""},r.tracks=e.data.response.songs.tracks):1==jQuery.isEmptyObject(e.data.response.songs[0].artist_location)?(r.artist_location={latitude:t.latitudeObj_root.latitude,longitude:t.longitudeObj_root.longitude,location:"No Location Data Available",location_link:""},r.tracks=e.data.response.songs.tracks):(r.artist_location=e.data.response.songs[0].artist_location,r.artist_location.location_link=e.data.response.songs[0].artist_location.location.replace(/,/g,"*"),r.tracks=e.data.response.songs.tracks),r},function(){r.artist_location={latitude:t.latitudeObj_root.latitude,longitude:t.longitudeObj_root.longitude,location:"No Location Data Available",location_link:""}})}return r.artist_location.location_link=r.artist_location.location.replace(/,/g,"*"),o.resolve(r),o.promise},createCities:function(e,t,r){return a.get("json/MajorCities.json").then(function(a){var n=a.data.feed.entry;return n.lat_plus_long=[],forEach(n,function(a){var i=n.indexOf(a),s=Math.abs(e-a.latitude.$t)+Math.abs(t-a.longitude.$t);a.id=i,r>s&&o.location.split("*")[0].toLowerCase()!=a.city.$t.toLowerCase()&&n.lat_plus_long.push({number:s,city:a.city.$t,lat:a.latitude.$t,"long":a.longitude.$t})}),n.lat_plus_long.sort(function(e,t){return e.number-t.number}),n.lat_plus_long})},runSongsAbout:function(e){if(""!=localStorage.country)var t='https://api.spotify.com/v1/search?q=track:"'+e.song+'"&type=track&limit=1&offset=0&market='+localStorage.country.toUpperCase();else var t='https://api.spotify.com/v1/search?q=track:"'+e.song+'"&type=track&limit=1&offset=0&market=';return a.get(t).then(function(t){return t.data.tracks.artist_location={},t.data.tracks.artist_location.location=e.city,t.data.tracks.artist_location.latitude=e.geolocation.split(", ")[0],t.data.tracks.artist_location.longitude=e.geolocation.split(", ")[1],t.data.tracks})},runLocationJSON:function(){return a.get("json/SongsAboutCities.json").then(function(e){return e.data.feed.entry})},runFusionTableJSON:function(e,t,r){if(51.50853==e&&t==-.12574)var o="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Id,Name,AvailableMarkets,SongLocation,SongLatitude,SongLongitude,ArtistsName,ArtistsId,AlbumId,AlbumName,AlbumAvailableMarkets,Favorite,ArtistLocation,ArtistLatitude,ArtistLongitude,ArtistLocationLink+FROM+16u2CEBr6_hvcYO9qoFEIQDMPb5TP60RHnLrI5Dgx++WHERE+SongLatitude+<="+(42.98339+r)+"+AND+SongLatitude>="+(42.98339-r)+"+AND+SongLongitude<="+(-81.23304+r)+"+AND+SongLongitude>="+(-81.23304-r)+"&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0";else var o="https://www.googleapis.com/fusiontables/v1/query?sql=SELECT+Id,Name,AvailableMarkets,SongLocation,SongLatitude,SongLongitude,ArtistsName,ArtistsId,AlbumId,AlbumName,AlbumAvailableMarkets,Favorite,ArtistLocation,ArtistLatitude,ArtistLongitude,ArtistLocationLink+FROM+16u2CEBr6_hvcYO9qoFEIQDMPb5TP60RHnLrI5Dgx++WHERE+SongLatitude+<="+(e+r)+"+AND+SongLatitude>="+(e-r)+"+AND+SongLongitude<="+(t+r)+"+AND+SongLongitude>="+(t-r)+"&key=AIzaSyBBcCEirvYGEa2QoGas7w2uaWQweDF2pi0";return a.get(o).then(function(e){var t=[],a="",r="";if(null!=localStorage.leaveOutArr)var o=jQuery.parseJSON(localStorage.leaveOutArr);else var o=[];if(void 0!=e.data.rows)for(var n=0;n<e.data.rows.length;n++)""==localStorage.country&&void 0==localStorage.country||a.match(e.data.rows[n][0])||!e.data.rows[n][2].toString().match(localStorage.country)||t.push({song_location:{location:e.data.rows[n][3],latitude:e.data.rows[n][4],longitude:e.data.rows[n][5]},name:e.data.rows[n][1],id:e.data.rows[n][0],artists:[{name:e.data.rows[n][6],id:e.data.rows[n][7]}],album:{id:e.data.rows[n][8],name:e.data.rows[n][9],available_markets:e.data.rows[n][10]},available_markets:e.data.rows[n][2],favorite:"off",artist_location:{latitude:e.data.rows[n][13],longitude:e.data.rows[n][14],location:e.data.rows[n][12],location_link:e.data.rows[n][15]},searchterm:e.data.rows[n][3]}),a+=e.data.rows[n][0]+":",r+=e.data.rows[n][1]+":";return t=compareArraysObj(t,o,"title")})},runRange:function(e){return e>15&&(zoom=2),e>10&&15>e&&(zoom=3),e>7&&10>e?zoom=4:e>5&&7>e?zoom=5:e>3&&5>e?zoom=6:e>2&&3>e?zoom=7:e>1&&2>e?zoom=8:e>.8&&1>e?zoom=9:e>.6&&.8>e?zoom=10:e>.29&&.6>e?zoom=11:e>.2&&.29>e?zoom=12:e>=0&&.2>e&&(zoom=13),zoom}}}]),MusicWhereYouAreApp.factory("ChunkSongs",["$q","$rootScope","$http","$sce","LocationDataFetch",function(e){return{createChunks:function(t,a){for(var r=e.defer(),o=t.length%a,n=t.length/a,i=Math.floor(n),s=[],l="",c=0;i>c;c++){var u=[],p=[];p=t.slice(c*a,c*a+a),forEach(p,function(e){u.push(e),l+=e.tracks[0].foreign_id.split(":")[2]+","}),l=l.slice(0,l.length-1),s.push({songs:u,url:"https://api.spotify.com/v1/tracks/?ids="+l,ids:l})}if(o>0){var u=[],p=t.slice(t.length-o,t.length);forEach(p,function(e){u.push(e),l+=e.tracks[0].foreign_id.split(":")[2]+","}),l=l.slice(0,l.length-1),s.push({songs:u,url:"https://api.spotify.com/v1/tracks/?ids="+l,ids:l})}return r.resolve(s),r.promise}}}]),MusicWhereYouAreApp.factory("loadPlaylist",["$q","$rootScope","$http","$sce","PlaylistCreate","Spotify",function(e,t,a,r,o){return{callPlaylistCreate:function(e,a,r,n,i,s,l,c,u,p,d,h){for(var e=e,a=a,g=[],f=0;10>f;f++){var h=100*f;o.runPlaylist(r,n,i,s,l,c,u,p,d,h).then(function(m){if(e=e.concat(m.data.response.songs),g.push(f),g.length==f&&e.length<200&&5>=a)if(a+=1,5>=a)$scope.stillLooking=!0,o.runPlaylist(r,n,i,s,l,c,u,p,d,h).then(function(e){return e});else if(0==$scope.songs.length&&$scope.counter>5)return t.noSongs=!0,"test"})}}}}]);